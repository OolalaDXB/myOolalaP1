<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <title>Cockpit — MyOolala</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90' font-family='serif' font-style='italic' fill='%231A3A3A'>Oo</text></svg>">

    <script src="/js/countries.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --bg-main: #F4F3F0;
            --bg-panel: #FFFFFF;
            --surface: #ECE8E2;
            --surface-hover: #E5E0D8;
            --ink: #1C1C1C;
            --ink-soft: #6A635D;
            --signature: #1A3A3A;
            --signature-light: #234545;
            --accent: #B8A89A;
            --success: #2E7D5A;
            --success-light: #4ade80;
            --warning: #D4A853;
            --error: #C45C5C;
            --gold: #C9A227;
            --platinum: #A8A9AD;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html, body {
            min-height: 100vh;
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-main);
            color: var(--ink);
            line-height: 1.6;
        }

        /* ══════════════════════════════════════
           LAYOUT — SIDEBAR + MAIN
           ══════════════════════════════════════ */
        .cockpit {
            display: grid;
            grid-template-columns: 260px 1fr 380px;
            min-height: 100vh;
            transition: grid-template-columns 0.3s ease;
        }

        .cockpit.preview-collapsed {
            grid-template-columns: 260px 1fr 50px;
        }

        /* ══════════════════════════════════════
           SIDEBAR — NAVIGATION
           ══════════════════════════════════════ */
        .sidebar {
            background: var(--signature);
            color: white;
            padding: 2rem 0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-brand {
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 1.5rem;
        }

        .sidebar-brand a {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            font-style: italic;
            color: white;
            text-decoration: none;
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: rgba(255,255,255,0.4);
            padding: 0 1.5rem;
            margin-bottom: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.08);
            color: white;
        }

        .nav-item.active {
            background: rgba(255,255,255,0.12);
            color: white;
            border-left: 2px solid white;
        }

        .nav-item svg {
            width: 18px;
            height: 18px;
            opacity: 0.7;
            flex-shrink: 0;
        }

        .nav-item.active svg {
            opacity: 1;
        }

        .sidebar-footer {
            padding: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* Pro Toggle */
        .pro-toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 0.5rem 0;
        }

        .pro-toggle-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: rgba(255,255,255,0.5);
        }

        .pro-toggle {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 2px;
            border: none;
            cursor: pointer;
        }

        .pro-toggle-option {
            padding: 0.35rem 0.75rem;
            font-size: 0.7rem;
            font-weight: 600;
            color: rgba(255,255,255,0.5);
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .pro-toggle-option.active {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .pro-toggle-option[data-mode="pro"].active {
            background: linear-gradient(135deg, var(--platinum) 0%, #C0C0C0 100%);
            color: #1a1a1a;
        }

        .profile-url {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.7);
        }

        .profile-url-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .copy-url-btn {
            background: none;
            border: none;
            color: rgba(255,255,255,0.5);
            cursor: pointer;
            padding: 0.25rem;
            transition: color 0.2s;
        }

        .copy-url-btn:hover {
            color: white;
        }

        /* ══════════════════════════════════════
           MAIN CONTENT — EDITOR PANELS
           ══════════════════════════════════════ */
        .main-content {
            padding: 2rem;
            overflow-y: auto;
            max-height: 100vh;
        }

        .panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .panel-header {
            margin-bottom: 2rem;
        }

        .panel-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.75rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .panel-subtitle {
            font-size: 0.9rem;
            color: var(--ink-soft);
        }

        /* Cards */
        .card {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(0,0,0,0.04);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.25rem;
        }

        .card-title {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .card-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 50px;
            background: var(--surface);
            color: var(--ink-soft);
        }

        .card-badge.pro {
            background: var(--signature);
            color: white;
        }

        .card-badge.lifetime {
            background: linear-gradient(135deg, var(--gold) 0%, #D4AF37 100%);
            color: white;
        }

        /* ══════════════════════════════════════
           MY CITIZEN — STATUS CARD
           ══════════════════════════════════════ */
        .citizen-hero {
            background: linear-gradient(135deg, var(--signature) 0%, #0D1F1F 100%);
            border-radius: 16px;
            padding: 2rem;
            color: white;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .citizen-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, transparent 70%);
            pointer-events: none;
        }

        .citizen-id-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .citizen-id {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.5rem;
            font-weight: 500;
            letter-spacing: 0.05em;
        }

        .citizen-id-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            opacity: 0.5;
            margin-bottom: 0.25rem;
        }

        .citizen-plan-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.8rem;
            background: rgba(255,255,255,0.1);
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .citizen-plan-badge.pro {
            background: rgba(255,255,255,0.2);
        }

        .citizen-plan-badge.lifetime {
            background: linear-gradient(135deg, var(--gold) 0%, #D4AF37 100%);
        }

        .citizen-plan-badge svg {
            width: 12px;
            height: 12px;
        }

        .citizen-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .citizen-stat {
            text-align: center;
        }

        .citizen-stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.15rem;
        }

        .citizen-stat-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.5;
        }

        /* Monthly Drop Card */
        .monthly-drop-card {
            background: linear-gradient(135deg, #1A3A3A 0%, #0D1F1F 100%);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            color: white;
            margin-bottom: 1.5rem;
        }

        .monthly-drop-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .monthly-drop-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-style: italic;
        }

        .monthly-drop-countdown {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.25rem 0.6rem;
            background: var(--success-light);
            color: #0D1F1F;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .monthly-drop-reward {
            font-size: 0.9rem;
            opacity: 0.85;
            margin-bottom: 0.75rem;
        }

        .monthly-drop-reward strong {
            color: white;
        }

        .monthly-drop-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            opacity: 0.6;
        }

        .monthly-drop-status .dot {
            width: 6px;
            height: 6px;
            background: var(--success-light);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* Member Info Card */
        .member-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .member-info-item {
            padding: 1rem;
            background: var(--bg-main);
            border-radius: 8px;
        }

        .member-info-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--ink-soft);
            margin-bottom: 0.25rem;
        }

        .member-info-value {
            font-size: 0.95rem;
            font-weight: 500;
        }

        /* ══════════════════════════════════════
           SPOTLIGHT PANEL
           ══════════════════════════════════════ */
        .spotlight-preview {
            background: var(--bg-main);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .spotlight-preview-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-style: italic;
            color: var(--ink-soft);
            margin-bottom: 0.5rem;
        }

        .spotlight-quote {
            font-size: 1rem;
            font-style: italic;
            color: var(--ink);
            padding: 0 1rem;
        }

        /* ══════════════════════════════════════
           FORM ELEMENTS
           ══════════════════════════════════════ */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--ink-soft);
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--surface);
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.9rem;
            background: var(--bg-main);
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--signature);
            background: white;
        }

        .form-input::placeholder {
            color: var(--accent);
        }

        textarea.form-input {
            resize: vertical;
            min-height: 80px;
        }

        .form-hint {
            font-size: 0.75rem;
            color: var(--accent);
            margin-top: 0.35rem;
        }

        .char-count {
            float: right;
        }

        /* Avatar Upload */
        .avatar-upload {
            display: flex;
            align-items: center;
            gap: 1.25rem;
        }

        .avatar-preview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--surface);
            background-image: url('https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80');
            background-size: cover;
            background-position: center;
        }

        .avatar-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.6rem 1.25rem;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-primary {
            background: var(--signature);
            color: white;
        }

        .btn-primary:hover {
            background: var(--signature-light);
        }

        .btn-primary.has-changes {
            position: relative;
        }

        .btn-primary.has-changes::after {
            content: '';
            position: absolute;
            top: -3px;
            right: -3px;
            width: 10px;
            height: 10px;
            background: var(--warning);
            border-radius: 50%;
            border: 2px solid var(--bg-main);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--ink);
        }

        .btn-secondary:hover {
            background: var(--surface-hover);
        }

        .btn-ghost {
            background: transparent;
            color: var(--ink-soft);
            padding: 0.5rem 0.75rem;
        }

        .btn-ghost:hover {
            background: var(--surface);
            color: var(--ink);
        }

        .btn-sm {
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--surface);
            color: var(--ink-soft);
        }

        .btn-outline:hover {
            border-color: var(--signature);
            color: var(--signature);
        }

        /* Toggle Switch */
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--surface);
        }

        .toggle-row:last-child {
            border-bottom: none;
        }

        .toggle-label {
            font-size: 0.9rem;
        }

        .toggle-desc {
            font-size: 0.75rem;
            color: var(--ink-soft);
            margin-top: 0.15rem;
        }

        .toggle {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--surface);
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .toggle.active {
            background: var(--signature);
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
        }

        .toggle.active::after {
            transform: translateX(20px);
        }

        /* Sortable List */
        .sortable-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .sortable-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--bg-main);
            border-radius: 8px;
            cursor: grab;
            transition: all 0.2s ease;
        }

        .sortable-item:hover {
            background: var(--surface);
        }

        .sortable-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .drag-handle {
            color: var(--accent);
            cursor: grab;
        }

        .sortable-item-content {
            flex: 1;
            min-width: 0;
        }

        .sortable-item-title {
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sortable-item-url {
            font-size: 0.75rem;
            color: var(--ink-soft);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sortable-item-actions {
            display: flex;
            gap: 0.25rem;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            border-radius: 6px;
            color: var(--ink-soft);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .icon-btn:hover {
            background: white;
            color: var(--ink);
        }

        .icon-btn.delete:hover {
            background: #FEE;
            color: var(--error);
        }

        /* Social Grid */
        .social-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 0.75rem;
        }

        .social-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .social-input-label {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.75rem;
            color: var(--ink-soft);
        }

        .social-input-label svg {
            width: 14px;
            height: 14px;
        }

        .social-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--surface);
            border-radius: 6px;
            font-size: 0.8rem;
            background: var(--bg-main);
        }

        .social-input:focus {
            outline: none;
            border-color: var(--signature);
            background: white;
        }

        /* Integration Grid (Music, Sport, etc.) */
        .integration-grid {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .integration-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-main);
            border-radius: 8px;
            transition: background 0.2s;
        }

        .integration-item:hover {
            background: var(--surface);
        }

        .integration-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .integration-icon svg {
            width: 22px;
            height: 22px;
        }

        .integration-icon.spotify { background: #1DB954; color: white; }
        .integration-icon.deezer { background: #FEAA2D; color: black; }
        .integration-icon.youtube-music { background: #FF0000; color: white; }
        .integration-icon.apple-music { background: linear-gradient(180deg, #FC5C7D 0%, #6A82FB 100%); color: white; }
        .integration-icon.soundcloud { background: #FF5500; color: white; }
        .integration-icon.strava { background: #FC4C02; color: white; }
        .integration-icon.playtomic { background: #00D084; color: white; }
        .integration-icon.whoop { background: #000; color: white; }
        .integration-icon.garmin { background: #007CC3; color: white; }

        .integration-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .integration-name {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--ink);
        }

        .integration-input {
            padding: 0.4rem 0.6rem;
            border: 1px solid var(--surface);
            border-radius: 6px;
            font-size: 0.8rem;
            background: white;
            width: 100%;
        }

        .integration-input:focus {
            outline: none;
            border-color: var(--signature);
        }

        /* Add Item Button */
        .add-item-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 1rem;
            border: 2px dashed var(--surface);
            border-radius: 8px;
            background: transparent;
            color: var(--ink-soft);
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .add-item-btn:hover {
            border-color: var(--accent);
            background: var(--bg-main);
            color: var(--ink);
        }

        /* Contact Items */
        .contact-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .contact-item {
            display: grid;
            grid-template-columns: 1fr 100px 32px;
            gap: 0.5rem;
            align-items: center;
        }

        .contact-item.with-platform {
            grid-template-columns: 120px 1fr 100px 32px;
        }

        .contact-item-info {
            display: flex;
            gap: 0.5rem;
            flex: 1;
        }

        .contact-item-info .phone-number {
            flex: 1;
            max-width: 180px;
        }

        .contact-item-info .phone-label {
            flex: 2;
        }

        .contact-item-delete {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: var(--ink-soft);
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .contact-item-delete:hover {
            background: #fee2e2;
            color: #dc2626;
        }

        .platform-select {
            padding: 0.5rem;
            border: 1px solid var(--surface);
            border-radius: 6px;
            font-size: 0.8rem;
            background: var(--bg-main);
        }

        .contact-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--surface);
            border-radius: 6px;
            font-size: 0.85rem;
            background: var(--bg-main);
        }

        .tag-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--surface);
            border-radius: 6px;
            font-size: 0.8rem;
            background: var(--bg-main);
        }

        /* Flag Picker */
        .flag-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            background: var(--bg-main);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .flag-row:hover {
            background: var(--surface);
        }

        .flag-display {
            font-size: 1.5rem;
        }

        .flag-info {
            flex: 1;
        }

        .flag-label {
            font-size: 0.8rem;
            color: var(--ink-soft);
        }

        .flag-value {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Multi-Flags Selector */
        .flags-selector {
            padding: 0.5rem 0;
        }

        .flags-selected {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.75rem;
            background: var(--bg-main);
            border-radius: 8px;
            min-height: 48px;
            align-items: center;
        }

        .flag-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.4rem 0.5rem;
            background: white;
            border: 1px solid var(--surface);
            border-radius: 6px;
            font-size: 1.25rem;
            cursor: grab;
            transition: all 0.2s ease;
        }

        .flag-chip:hover {
            border-color: var(--signature);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .flag-chip.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .flag-remove {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border: none;
            background: var(--surface);
            border-radius: 50%;
            font-size: 0.75rem;
            color: var(--ink-soft);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: 0.25rem;
        }

        .flag-remove:hover {
            background: var(--error);
            color: white;
        }

        .flag-add-btn {
            display: inline-flex;
            align-items: center;
            padding: 0.4rem 0.75rem;
            background: transparent;
            border: 1px dashed var(--accent);
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--ink-soft);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .flag-add-btn:hover {
            border-color: var(--signature);
            color: var(--signature);
            background: white;
        }

        .flags-preview-display {
            margin-top: 0.75rem;
            padding: 0.5rem 0.75rem;
            background: white;
            border-radius: 6px;
            font-size: 0.85rem;
            color: var(--ink-soft);
        }

        .flags-preview-display span {
            font-size: 1rem;
            letter-spacing: 0.1em;
        }

        /* Flag Picker Modal Grid */
        .flag-picker-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .flag-picker-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            background: var(--bg-main);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .flag-picker-item:hover {
            background: white;
            border-color: var(--surface);
        }

        .flag-picker-item.selected {
            border-color: var(--signature);
            background: white;
        }

        .flag-picker-item.active {
            border-color: var(--gold);
            background: #FFFBF0;
            transform: scale(1.05);
        }

        .flag-picker-item .flag-emoji {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .flag-picker-item .flag-code {
            font-size: 0.6rem;
            color: var(--ink-soft);
            text-transform: uppercase;
        }

        /* Home Base Selector */
        .homebase-selector {
            padding: 0.5rem 0;
        }

        .homebase-current {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-main);
            border-radius: 8px;
            border: 2px solid var(--signature);
        }

        .homebase-code {
            font-family: 'Space Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--signature);
            letter-spacing: 0.05em;
        }

        .homebase-city {
            font-size: 0.95rem;
            font-weight: 500;
        }

        .homebase-ref {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: var(--ink-soft);
            letter-spacing: 0.05em;
        }

        .airport-results {
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid var(--surface);
            border-radius: 8px;
            margin-top: 0.5rem;
        }

        .airport-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .airport-option:hover {
            background: var(--bg-main);
        }

        .airport-option-code {
            font-family: 'Space Mono', monospace;
            font-weight: 600;
            color: var(--signature);
        }

        /* Views List */
        .views-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .view-item {
            background: var(--bg-main);
            border-radius: 10px;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .view-item:hover {
            background: var(--surface);
        }

        .view-item.expanded {
            border-color: var(--signature);
            background: white;
        }

        .view-item-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            cursor: pointer;
        }

        .view-item-expanded {
            display: none;
            padding: 0 1rem 1rem;
            border-top: 1px solid var(--surface);
        }

        .view-item.expanded .view-item-expanded {
            display: block;
        }

        .view-item.expanded .expand-indicator svg {
            transform: rotate(180deg);
        }

        .expand-indicator svg {
            transition: transform 0.2s ease;
        }

        .view-drag-handle {
            cursor: grab;
            color: var(--accent);
            opacity: 0.5;
        }

        .view-drag-handle:hover {
            opacity: 1;
        }

        .view-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .view-info {
            flex: 1;
            min-width: 0;
        }

        .view-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 0.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .view-vip-badge {
            font-size: 0.6rem;
            font-weight: 600;
            padding: 0.15rem 0.4rem;
            background: var(--signature);
            color: #FAF9F6;
            border-radius: 4px;
            letter-spacing: 0.05em;
        }

        .view-url {
            font-size: 0.75rem;
            color: var(--ink-soft);
            font-family: 'Space Mono', monospace;
        }

        .view-url strong {
            color: var(--signature);
        }

        .view-url-private {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            color: var(--ink-soft);
            font-family: 'DM Sans', sans-serif;
            font-style: italic;
        }

        .view-meta {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: var(--ink-soft);
        }

        .view-visibility-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .view-visibility-badge.public {
            background: #E8F5E9;
            color: #2E7D5A;
        }

        .view-visibility-badge.private {
            background: var(--surface);
            color: var(--ink-soft);
        }

        .view-stat {
            font-size: 0.75rem;
            color: var(--ink-soft);
        }

        .view-actions {
            display: flex;
            gap: 0.25rem;
        }

        .view-action-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--ink-soft);
            transition: all 0.2s ease;
        }

        .view-action-btn:hover {
            background: var(--surface);
            color: var(--signature);
        }

        /* View expanded content */
        .view-visibility-toggle {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0 0.5rem;
        }

        .view-visibility-label {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--ink-soft);
        }

        .visibility-switch {
            display: flex;
            background: var(--surface);
            border-radius: 6px;
            padding: 3px;
        }

        .visibility-btn {
            padding: 0.4rem 0.75rem;
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: 0.8rem;
            color: var(--ink-soft);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .visibility-btn.active {
            background: white;
            color: var(--ink);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .view-visibility-hint {
            font-size: 0.75rem;
            color: var(--ink-soft);
            margin: 0 0 1rem;
            font-style: italic;
        }

        .view-permanent-link {
            background: var(--bg-main);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
        }

        .view-permanent-label {
            font-size: 0.7rem;
            color: var(--ink-soft);
            display: block;
            margin-bottom: 0.35rem;
        }

        .view-permanent-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
        }

        .view-permanent-row code {
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            color: var(--signature);
        }

        .copy-mini-btn {
            padding: 0.3rem 0.6rem;
            background: var(--signature);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-mini-btn:hover {
            background: var(--ink);
        }

        .view-aliases-section {
            margin-bottom: 1rem;
        }

        .view-aliases-label {
            font-size: 0.7rem;
            color: var(--ink-soft);
            display: block;
            margin-bottom: 0.5rem;
        }

        .add-alias-btn {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 0.75rem;
            background: transparent;
            border: 1px dashed var(--surface);
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.75rem;
            color: var(--ink-soft);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 0.5rem;
        }

        .add-alias-btn:hover {
            border-color: var(--signature);
            color: var(--signature);
        }

        .alias-revoked {
            opacity: 0.5;
        }

        .alias-revoked .alias-input {
            text-decoration: line-through;
            color: var(--ink-soft);
        }

        .alias-invalid {
            border-color: #dc2626 !important;
            background: #fef2f2 !important;
        }

        .alias-invalid .alias-input {
            color: #dc2626;
        }

        .alias-error {
            font-size: 0.7rem;
            color: #dc2626;
            padding: 0.25rem 0.5rem;
            margin-top: 0.25rem;
        }

        .view-quick-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 0.5rem 0.75rem !important;
            font-size: 0.75rem !important;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }
        }

        .view-action-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--ink-soft);
            transition: all 0.2s ease;
        }

        .view-action-btn:hover {
            background: var(--surface);
            color: var(--signature);
        }

        /* Quick Share Grid */
        .quick-share-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }

        .quick-share-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: var(--bg-main);
            border: 1px solid var(--surface);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-share-btn:hover {
            background: white;
            border-color: var(--signature);
            transform: translateY(-2px);
        }

        .quick-share-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .quick-share-label {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .quick-share-btn svg {
            color: var(--ink-soft);
        }

        /* ══════════════════════════════════════
           LINK MANAGEMENT & ALIASES
           ══════════════════════════════════════ */
        .link-section {
            margin-bottom: 0;
        }

        .link-section-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.35rem;
        }

        .link-section-title {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .link-section-badge {
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
            background: var(--surface);
            border-radius: 4px;
            color: var(--ink-soft);
        }

        .link-section-desc {
            font-size: 0.8rem;
            color: var(--ink-soft);
            margin-bottom: 0.75rem;
        }

        .permanent-link-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .permanent-link-display {
            flex: 1;
            padding: 0.75rem 1rem;
            background: var(--bg-main);
            border-radius: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
        }

        .permanent-link-prefix {
            color: var(--ink-soft);
        }

        .permanent-link-hash {
            color: var(--signature);
            font-weight: 600;
        }

        .copy-link-btn {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.6rem 1rem;
            background: var(--signature);
            color: white;
            border: none;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .copy-link-btn:hover {
            background: var(--ink);
        }

        /* Alias List */
        .alias-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .alias-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-main);
            border-radius: 8px;
            border: 1px solid var(--surface);
        }

        .alias-input-row {
            flex: 1;
            display: flex;
            align-items: center;
        }

        .alias-prefix {
            font-size: 0.8rem;
            color: var(--ink-soft);
        }

        .alias-input {
            flex: 1;
            padding: 0.4rem 0.5rem;
            border: none;
            background: transparent;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: var(--signature);
            font-weight: 500;
        }

        .alias-input:focus {
            outline: none;
            background: white;
            border-radius: 4px;
        }

        .alias-actions {
            display: flex;
            gap: 0.25rem;
        }

        .alias-copy-btn,
        .alias-delete-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--ink-soft);
            transition: all 0.2s ease;
        }

        .alias-copy-btn:hover {
            background: var(--surface);
            color: var(--signature);
        }

        .alias-delete-btn:hover {
            background: #fee2e2;
            color: #dc2626;
        }

        /* Visibility Options */
        .visibility-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .visibility-option {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--bg-main);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .visibility-option:hover {
            background: var(--surface);
        }

        .visibility-option input {
            display: none;
        }

        .visibility-radio {
            width: 18px;
            height: 18px;
            border: 2px solid var(--surface);
            border-radius: 50%;
            flex-shrink: 0;
            margin-top: 2px;
            transition: all 0.2s ease;
        }

        .visibility-option input:checked + .visibility-radio {
            border-color: var(--signature);
            background: var(--signature);
            box-shadow: inset 0 0 0 3px white;
        }

        .visibility-info {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .visibility-label {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .visibility-desc {
            font-size: 0.75rem;
            color: var(--ink-soft);
        }

        /* ══════════════════════════════════════
           ANALYTICS PANEL
           ══════════════════════════════════════ */
        .analytics-period {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: white;
            padding: 0.5rem;
            border-radius: 10px;
        }

        .period-btn {
            flex: 1;
            padding: 0.6rem 1rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.85rem;
            color: var(--ink-soft);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .period-btn:hover {
            background: var(--bg-main);
        }

        .period-btn.active {
            background: var(--signature);
            color: white;
        }

        .period-btn.pro-only {
            position: relative;
            color: var(--accent);
        }

        .period-btn.pro-only::after {
            content: 'PRO';
            position: absolute;
            top: -6px;
            right: -6px;
            font-size: 0.5rem;
            background: var(--gold);
            color: white;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-weight: 600;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .analytics-stat {
            text-align: center;
            padding: 1rem 0.5rem;
            background: var(--bg-main);
            border-radius: 10px;
        }

        .analytics-stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--signature);
            margin-bottom: 0.25rem;
        }

        .analytics-stat-label {
            font-size: 0.75rem;
            color: var(--ink-soft);
            margin-bottom: 0.35rem;
        }

        .analytics-stat-change {
            font-size: 0.7rem;
            font-weight: 500;
        }

        .analytics-stat-change.positive {
            color: var(--success);
        }

        .analytics-stat-change.negative {
            color: var(--error);
        }

        /* Mini Chart */
        .analytics-chart-mini {
            padding: 1rem 0;
        }

        .chart-bars {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 80px;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .chart-bar {
            flex: 1;
            background: var(--surface);
            border-radius: 4px 4px 0 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .chart-bar:hover,
        .chart-bar.active {
            background: var(--signature);
        }

        .chart-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.65rem;
            color: var(--ink-soft);
            text-transform: uppercase;
        }

        /* Links List */
        .analytics-links-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .analytics-link-item {
            display: grid;
            grid-template-columns: 28px 1fr auto 80px;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-main);
            border-radius: 8px;
        }

        .analytics-link-rank {
            width: 28px;
            height: 28px;
            background: var(--signature);
            color: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .analytics-link-title {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .analytics-link-url {
            font-size: 0.7rem;
            color: var(--ink-soft);
        }

        .analytics-link-clicks {
            font-size: 0.8rem;
            color: var(--ink-soft);
            white-space: nowrap;
        }

        .analytics-link-bar {
            height: 4px;
            background: var(--surface);
            border-radius: 2px;
            overflow: hidden;
        }

        .analytics-link-bar-fill {
            height: 100%;
            background: var(--signature);
            border-radius: 2px;
        }

        /* Geo List */
        .analytics-geo-list {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .analytics-geo-item {
            display: grid;
            grid-template-columns: 32px 1fr auto 60px;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--surface);
        }

        .analytics-geo-item:last-child {
            border-bottom: none;
        }

        .analytics-geo-flag {
            font-size: 1.25rem;
        }

        .analytics-geo-country {
            font-size: 0.9rem;
        }

        .analytics-geo-value {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--signature);
        }

        .analytics-geo-bar {
            height: 4px;
            background: var(--surface);
            border-radius: 2px;
            overflow: hidden;
        }

        .analytics-geo-bar-fill {
            height: 100%;
            background: var(--signature);
            border-radius: 2px;
        }

        /* PRO Locked Cards */
        .card.pro-locked {
            position: relative;
            overflow: hidden;
        }

        .card.pro-locked > *:not(.pro-overlay) {
            opacity: 0.4;
            filter: blur(1px);
            pointer-events: none;
        }

        /* Mode Pro — Unlock everything */
        body.pro-mode .card.pro-locked > *:not(.pro-overlay) {
            opacity: 1;
            filter: none;
            pointer-events: auto;
        }

        body.pro-mode .pro-overlay {
            display: none !important;
        }

        body.pro-mode .citizen-plan-badge {
            background: linear-gradient(135deg, var(--platinum) 0%, #C0C0C0 100%) !important;
            color: #1a1a1a !important;
        }

        body.pro-mode .citizen-plan-badge::before {
            content: '✦ ';
        }

        body.pro-mode .achievement.locked {
            filter: none;
            opacity: 1;
        }

        body.pro-mode .achievement.locked .achievement-icon {
            background: linear-gradient(135deg, var(--platinum) 0%, #C0C0C0 100%);
            color: #1a1a1a;
        }

        .pro-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            gap: 0.75rem;
        }

        .pro-lock-icon {
            width: 48px;
            height: 48px;
            background: var(--surface);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--ink-soft);
        }

        .pro-lock-text {
            font-weight: 600;
            color: var(--ink);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Preview Placeholders for Pro Features */
        .analytics-map-placeholder {
            height: 150px;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
        }

        .map-preview {
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 300'%3E%3Crect fill='%23ECE8E2' width='500' height='300'/%3E%3Cpath fill='%23D4D0C8' d='M50 80c20-10 60-20 100-10s80 40 120 30 60-40 100-30 80 30 80 30v200H50z'/%3E%3C/svg%3E") center/cover;
            opacity: 0.5;
        }

        .analytics-sources-preview,
        .analytics-devices-preview {
            padding: 1rem 0;
        }

        .source-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
        }

        .source-item.blurred {
            filter: blur(2px);
        }

        .source-icon {
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }

        .source-name {
            flex: 1;
            font-size: 0.9rem;
            min-width: 80px;
        }

        .source-bar {
            flex: 2;
            height: 8px;
            background: var(--surface);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 0.75rem;
        }

        .source-fill {
            height: 100%;
            background: var(--signature);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .source-value {
            font-weight: 600;
            color: var(--signature);
            min-width: 40px;
            text-align: right;
        }

        /* Geographic Stats */
        .geo-stats-grid {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .geo-stat {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .geo-stat-country {
            font-size: 0.85rem;
            min-width: 140px;
        }

        .geo-stat-bar {
            flex: 1;
            height: 8px;
            background: var(--surface);
            border-radius: 4px;
            overflow: hidden;
        }

        .geo-stat-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--signature) 0%, var(--accent) 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .geo-stat-value {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--signature);
            min-width: 40px;
            text-align: right;
        }

        .device-donut {
            width: 100px;
            height: 100px;
            background: conic-gradient(var(--signature) 0% 72%, var(--accent) 72% 96%, var(--surface) 96% 100%);
            border-radius: 50%;
            margin: 0 auto 1rem;
        }

        .device-donut.blurred {
            filter: blur(3px);
        }

        .device-legend {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            font-size: 0.8rem;
        }

        .device-legend.blurred {
            filter: blur(2px);
        }

        .device-legend-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .dot.mobile { background: var(--signature); }
        .dot.desktop { background: var(--accent); }
        .dot.tablet { background: var(--surface); }

        .realtime-preview {
            text-align: center;
            padding: 1.5rem;
        }

        .realtime-preview.blurred {
            filter: blur(3px);
        }

        .realtime-count {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .realtime-pulse {
            width: 12px;
            height: 12px;
            background: var(--success-light);
            border-radius: 50%;
            animation: pulse-realtime 1.5s ease-in-out infinite;
        }

        @keyframes pulse-realtime {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        .realtime-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--signature);
        }

        .realtime-label {
            font-size: 0.9rem;
            color: var(--ink-soft);
        }

        .advanced-tools-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .advanced-tool {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-main);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .advanced-tool.blurred {
            filter: blur(2px);
        }

        .advanced-tool svg {
            color: var(--signature);
            flex-shrink: 0;
        }

        /* Analytics Footer */
        .analytics-footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: 1rem;
            background: white;
            border-radius: 12px;
        }

        .plausible-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--ink-soft);
            margin-bottom: 0.5rem;
        }

        .plausible-badge svg {
            color: var(--success);
        }

        .plausible-badge strong {
            color: var(--ink);
        }

        .plausible-note {
            font-size: 0.75rem;
            color: var(--accent);
        }

        /* ══════════════════════════════════════
           RANKING PANEL
           ══════════════════════════════════════ */
        .ranking-hero-card {
            background: linear-gradient(135deg, var(--signature) 0%, #1a1a2e 100%);
            color: white;
        }

        .ranking-hero {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 1rem 0;
        }

        .ranking-position {
            display: flex;
            align-items: baseline;
        }

        .ranking-hash {
            font-size: 1.5rem;
            opacity: 0.6;
            font-weight: 300;
        }

        .ranking-number {
            font-family: 'Cormorant Garamond', serif;
            font-size: 4rem;
            font-weight: 700;
            line-height: 1;
        }

        .ranking-context {
            flex: 1;
        }

        .ranking-label {
            font-size: 0.85rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .ranking-total {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .ranking-total strong {
            color: white;
            opacity: 1;
        }

        .percentile-badge {
            display: inline-block;
            margin-top: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .ranking-movement {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.85rem;
        }

        .movement-icon {
            font-size: 1rem;
        }

        .movement-icon.positive {
            color: #4ade80;
        }

        .movement-icon.negative {
            color: #f87171;
        }

        /* Category Rankings */
        .ranking-categories {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .ranking-category-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: var(--bg-main);
            border-radius: 10px;
            transition: all 0.2s ease;
        }

        .ranking-category-item:hover {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .ranking-category-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ranking-category-info {
            flex: 1;
        }

        .ranking-category-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .ranking-category-desc {
            font-size: 0.75rem;
            color: var(--ink-soft);
        }

        .ranking-category-rank {
            text-align: right;
        }

        .rank-number {
            display: block;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--signature);
        }

        .rank-change {
            font-size: 0.7rem;
            font-weight: 500;
        }

        .rank-change.positive {
            color: var(--success);
        }

        .rank-change.negative {
            color: var(--error);
        }

        /* Leaderboard */
        .leaderboard-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .leaderboard-tab {
            padding: 0.4rem 0.75rem;
            border: none;
            background: var(--bg-main);
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.75rem;
            color: var(--ink-soft);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .leaderboard-tab:hover,
        .leaderboard-tab.active {
            background: var(--signature);
            color: white;
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .leaderboard-item {
            display: grid;
            grid-template-columns: 36px 40px 1fr auto;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-main);
            border-radius: 10px;
            transition: all 0.2s ease;
        }

        .leaderboard-item:hover {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .leaderboard-item.gold {
            background: linear-gradient(135deg, #FFF8E1 0%, #FFECB3 100%);
            border: 1px solid #FFD54F;
        }

        .leaderboard-item.silver {
            background: linear-gradient(135deg, #FAFAFA 0%, #E0E0E0 100%);
            border: 1px solid #BDBDBD;
        }

        .leaderboard-item.bronze {
            background: linear-gradient(135deg, #FBE9E7 0%, #FFCCBC 100%);
            border: 1px solid #FFAB91;
        }

        .leaderboard-item.you {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            border: 2px solid var(--signature);
        }

        .leaderboard-rank {
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--ink-soft);
            text-align: center;
        }

        .leaderboard-item.gold .leaderboard-rank { color: #F9A825; }
        .leaderboard-item.silver .leaderboard-rank { color: #757575; }
        .leaderboard-item.bronze .leaderboard-rank { color: #E64A19; }

        .leaderboard-avatar img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .leaderboard-info {
            min-width: 0;
        }

        .leaderboard-name {
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .you-badge {
            display: inline-block;
            padding: 0.1rem 0.4rem;
            background: var(--signature);
            color: white;
            border-radius: 4px;
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 0.25rem;
            vertical-align: middle;
        }

        .leaderboard-stats {
            font-size: 0.7rem;
            color: var(--ink-soft);
        }

        .leaderboard-score {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--signature);
        }

        .leaderboard-divider {
            text-align: center;
            padding: 0.5rem;
            color: var(--accent);
            font-size: 0.8rem;
        }

        /* Achievements */
        .badge-count {
            font-size: 0.8rem;
            color: var(--ink-soft);
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
        }

        .achievement {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 1rem 0.5rem;
            background: var(--bg-main);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .achievement.unlocked {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .achievement.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .achievement-name {
            font-weight: 600;
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .achievement-desc {
            font-size: 0.65rem;
            color: var(--ink-soft);
        }

        /* Pro Features List */
        .pro-features-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .pro-feature-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-main);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .pro-feature-item svg {
            color: var(--signature);
            flex-shrink: 0;
        }

        /* Ranking Footer */
        .ranking-footer {
            text-align: center;
            padding: 1.5rem;
            margin-top: 1rem;
            background: white;
            border-radius: 12px;
        }

        .ranking-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--ink-soft);
        }

        .ranking-info svg {
            flex-shrink: 0;
        }

        /* ══════════════════════════════════════
           PREVIEW PANEL — LIVE PREVIEW
           ══════════════════════════════════════ */
        .preview-panel {
            background: var(--surface);
            border-left: 1px solid rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease, min-width 0.3s ease;
        }

        .preview-panel.collapsed {
            width: 50px !important;
            min-width: 50px !important;
        }

        .preview-panel.collapsed .preview-container,
        .preview-panel.collapsed .preview-view-select,
        .preview-panel.collapsed .preview-device-toggle,
        .preview-panel.collapsed .preview-title {
            display: none;
        }

        .preview-panel.collapsed .preview-header {
            flex-direction: column;
            padding: 1rem 0.5rem;
        }

        .preview-panel.collapsed .preview-collapse-btn svg {
            transform: rotate(180deg);
        }

        .preview-header {
            padding: 1rem 1.5rem;
            background: white;
            border-bottom: 1px solid var(--surface);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .preview-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .preview-collapse-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--surface);
            background: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--ink-soft);
            transition: all 0.2s ease;
        }

        .preview-collapse-btn:hover {
            border-color: var(--signature);
            color: var(--signature);
        }

        .preview-collapse-btn svg {
            width: 16px;
            height: 16px;
            transition: transform 0.3s ease;
        }

        .preview-title {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .preview-view-select {
            padding: 0.4rem 0.75rem;
            border: 1px solid var(--surface);
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.8rem;
            background: white;
            cursor: pointer;
        }

        .preview-view-select:focus {
            outline: none;
            border-color: var(--signature);
        }

        .preview-device-toggle {
            display: flex;
            gap: 0.25rem;
            background: var(--surface);
            border-radius: 6px;
            padding: 0.2rem;
        }

        .device-btn {
            padding: 0.4rem 0.6rem;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            color: var(--ink-soft);
            transition: all 0.2s ease;
        }

        .device-btn.active {
            background: white;
            color: var(--ink);
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .device-btn svg {
            width: 18px;
            height: 18px;
            display: block;
        }

        .preview-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            overflow: hidden;
        }

        .preview-frame {
            width: 375px;
            height: 667px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.15);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .preview-frame.desktop {
            width: 100%;
            max-width: 800px;
            height: 500px;
            border-radius: 8px;
        }

        .preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .preview-actions {
            padding: 1rem 1.5rem;
            background: white;
            border-top: 1px solid var(--surface);
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }

        /* ══════════════════════════════════════
           FLAG PICKER MODAL
           ══════════════════════════════════════ */
        .flag-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .flag-btn {
            width: 100%;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border: 2px solid transparent;
            border-radius: 8px;
            background: var(--bg-main);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .flag-btn:hover {
            background: var(--surface);
            transform: scale(1.1);
        }

        .flag-btn.selected {
            border-color: var(--signature);
            background: white;
        }

        /* ══════════════════════════════════════
           MODAL
           ══════════════════════════════════════ */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 480px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        .modal-content.wide {
            max-width: 680px;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--surface);
        }

        .modal-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: 60vh;
        }

        .modal-footer {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--surface);
        }

        /* ══════════════════════════════════════
           TOAST
           ══════════════════════════════════════ */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--ink);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* ══════════════════════════════════════
           PAYMENT METHODS
           ══════════════════════════════════════ */
        .payment-method {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--bg-main);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .payment-method:last-child {
            margin-bottom: 0;
        }

        .payment-method-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .payment-method-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .payment-status {
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .payment-status.connected {
            background: #E8F5E9;
            color: var(--success);
        }

        .payment-status.not-connected {
            background: var(--surface);
            color: var(--ink-soft);
        }

        /* ══════════════════════════════════════
           RESPONSIVE
           ══════════════════════════════════════ */
        @media (max-width: 1200px) {
            .cockpit {
                grid-template-columns: 240px 1fr;
            }
            .preview-panel {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .cockpit {
                grid-template-columns: 1fr;
            }
            .sidebar {
                display: none;
            }
            .main-content {
                padding: 1rem;
            }
            .analytics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .analytics-link-item {
                grid-template-columns: 28px 1fr;
                gap: 0.5rem;
            }
            .analytics-link-clicks,
            .analytics-link-bar {
                display: none;
            }
            .achievements-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .leaderboard-tabs {
                flex-wrap: wrap;
            }
            .ranking-hero {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="cockpit">
        
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <a href="/">myOolala</a>
            </div>

            <nav class="sidebar-nav">
                <!-- MY CITIZEN — First Section -->
                <div class="nav-section">
                    <div class="nav-section-label">Citizen</div>
                    <button class="nav-item active" data-panel="citizen">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        My Citizen
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-label">Profile</div>
                    <button class="nav-item" data-panel="identity">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        Identity
                    </button>
                    <button class="nav-item" data-panel="views">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                        Multi-Views
                    </button>
                    <button class="nav-item" data-panel="spotlight">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                        Spotlight
                    </button>
                    <button class="nav-item" data-panel="links">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                        Links
                    </button>
                    <button class="nav-item" data-panel="socials">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
                        Socials & Contact
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-label">Monetization</div>
                    <button class="nav-item" data-panel="shop">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                        Shop
                    </button>
                    <button class="nav-item" data-panel="locked">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        Locked Content
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-label">Media</div>
                    <button class="nav-item" data-panel="music">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="5.5" cy="17.5" r="2.5"/><circle cx="17.5" cy="15.5" r="2.5"/><path d="M8 17V5l12-2v12"/></svg>
                        Music & Playlists
                    </button>
                    <button class="nav-item" data-panel="sport">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>
                        Sport & Health
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-label">Insights</div>
                    <button class="nav-item" data-panel="analytics">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
                        Analytics
                    </button>
                    <button class="nav-item" data-panel="ranking">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 15l-2 5l-5-1l3-4"/><path d="M12 15l2 5l5-1l-3-4"/><path d="M6 9a6 6 0 1 1 12 0c0 3-2 5-6 9c-4-4-6-6-6-9z"/></svg>
                        Ranking
                    </button>
                </div>

                <div class="nav-section">
                    <div class="nav-section-label">Settings</div>
                    <button class="nav-item" data-panel="settings">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                        Settings
                    </button>
                </div>
            </nav>

            <div class="sidebar-footer">
                <!-- Pro Toggle for Demo -->
                <div class="pro-toggle-container">
                    <span class="pro-toggle-label">Demo Mode</span>
                    <button class="pro-toggle" id="pro-toggle" onclick="toggleProMode()">
                        <span class="pro-toggle-option" data-mode="free">Free</span>
                        <span class="pro-toggle-option active" data-mode="pro">Platinum</span>
                    </button>
                </div>
                <div class="profile-url">
                    <span class="profile-url-text" id="sidebar-url">myoolala.com/username</span>
                    <button class="copy-url-btn" title="Copy URL" onclick="copyProfileUrl()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- ══════════════════════════════════════
                 MY CITIZEN PANEL
                 ══════════════════════════════════════ -->
            <section class="panel active" id="panel-citizen">
                <div class="panel-header">
                    <h1 class="panel-title">My Citizen</h1>
                    <p class="panel-subtitle">Your status in the Oolala community</p>
                </div>

                <!-- Citizen Hero Card -->
                <div class="citizen-hero">
                    <div class="citizen-id-row">
                        <div>
                            <div class="citizen-id-label">Citizen ID</div>
                            <div class="citizen-id" id="citizen-id-display">#0842</div>
                        </div>
                        <div class="citizen-plan-badge" id="citizen-plan-badge">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            Free
                        </div>
                    </div>
                    <div class="citizen-stats">
                        <div class="citizen-stat">
                            <div class="citizen-stat-value" id="stat-views">—</div>
                            <div class="citizen-stat-label">Profile Views</div>
                        </div>
                        <div class="citizen-stat">
                            <div class="citizen-stat-value" id="stat-clicks">—</div>
                            <div class="citizen-stat-label">Link Clicks</div>
                        </div>
                        <div class="citizen-stat">
                            <div class="citizen-stat-value" id="stat-ctr">—</div>
                            <div class="citizen-stat-label">CTR</div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Drop Card -->
                <div class="monthly-drop-card">
                    <div class="monthly-drop-header">
                        <span class="monthly-drop-title">The Monthly Drop</span>
                        <span class="monthly-drop-countdown" id="drop-countdown">In 12 days</span>
                    </div>
                    <p class="monthly-drop-reward">
                        Next reward: <strong id="drop-reward">Lifetime Membership + ID #0077</strong>
                    </p>
                    <div class="monthly-drop-status">
                        <div class="dot"></div>
                        <span>You are automatically entered</span>
                    </div>
                </div>

                <!-- Member Info -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Membership</span>
                    </div>
                    <div class="member-info">
                        <div class="member-info-item">
                            <div class="member-info-label">Member Since</div>
                            <div class="member-info-value" id="member-since">—</div>
                        </div>
                        <div class="member-info-item">
                            <div class="member-info-label">Plan</div>
                            <div class="member-info-value" id="member-plan">Free</div>
                        </div>
                    </div>
                    <div style="margin-top: 1.25rem;">
                        <button class="btn btn-primary" id="upgrade-btn" onclick="openUpgradeModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                            Upgrade to Pro — $3/month
                        </button>
                    </div>
                </div>

                <!-- Past Winners -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Recent Selections</span>
                        <span class="card-badge">Archive</span>
                    </div>
                    <div class="sortable-list" id="past-winners">
                        <div class="sortable-item" style="cursor: default;">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--surface);"></div>
                            <div class="sortable-item-content">
                                <div class="sortable-item-title">@marcelo_dubai</div>
                                <div class="sortable-item-url">December 2024 — Lifetime + ID #0042</div>
                            </div>
                        </div>
                        <div class="sortable-item" style="cursor: default;">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--surface);"></div>
                            <div class="sortable-item-content">
                                <div class="sortable-item-title">@creativelena</div>
                                <div class="sortable-item-url">November 2024 — Featured Citizen</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 IDENTITY PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-identity">
                <div class="panel-header">
                    <h1 class="panel-title">Identity</h1>
                    <p class="panel-subtitle">How you appear to the world</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Profile Photo</span>
                    </div>
                    <div class="avatar-upload">
                        <div class="avatar-preview" id="avatar-preview"></div>
                        <div class="avatar-actions">
                            <button class="btn btn-secondary btn-sm" onclick="document.getElementById('avatar-input').click()">Upload Photo</button>
                            <button class="btn btn-ghost btn-sm" onclick="removeAvatar()">Remove</button>
                            <input type="file" id="avatar-input" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Basic Info</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Display Name</label>
                        <input type="text" class="form-input" id="input-display-name" placeholder="Your name" onchange="markUnsaved()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Handle</label>
                        <input type="text" class="form-input" id="input-username" placeholder="username" onchange="markUnsaved()">
                        <div class="form-hint">myoolala.com/<strong id="username-preview">username</strong></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Bio</label>
                        <textarea class="form-input" id="input-bio" placeholder="Tell your story in a few words..." maxlength="160" onchange="markUnsaved()"></textarea>
                        <div class="form-hint">
                            <span class="char-count"><span id="bio-count">0</span>/160</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Origin & Location</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--ink-soft); margin-bottom: 1rem;">
                        Show your journey — select all the countries that define you.
                    </p>
                    <div class="flags-selector">
                        <div class="flags-selected" id="flags-selected">
                            <span class="flag-chip" data-country="MX">🇲🇽<button class="flag-remove" onclick="removeFlag('MX')">×</button></span>
                            <span class="flag-chip" data-country="US">🇺🇸<button class="flag-remove" onclick="removeFlag('US')">×</button></span>
                            <button class="flag-add-btn" onclick="openFlagPicker()">+ Add</button>
                        </div>
                        <div class="flags-preview-display">
                            Preview: <span id="flags-preview-text">🇲🇽 → 🇺🇸</span>
                        </div>
                        <div class="form-hint" style="margin-top: 0.5rem;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                            Drag to reorder. First flag is origin, last is current location.
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Home Base</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--ink-soft); margin-bottom: 1rem;">
                        Your airport code defines your Citizen reference. This is permanent.
                    </p>
                    <div class="homebase-selector">
                        <div class="homebase-current" id="homebase-display">
                            <div class="homebase-code">JFK</div>
                            <div class="homebase-info">
                                <div class="homebase-city">New York</div>
                                <div class="homebase-ref">JFK • 0010-2005</div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 1rem;">
                            <label class="form-label">Search Airport</label>
                            <input type="text" class="form-input" id="homebase-search" placeholder="Search by city or airport code..." onkeyup="searchAirport(this.value)">
                        </div>
                        <div class="airport-results" id="airport-results" style="display: none;">
                            <!-- Airport search results -->
                        </div>
                    </div>
                    <div class="form-hint" style="margin-top: 0.5rem;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 0.25rem;"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                        Your Citizen reference (e.g. JFK • 0010-2005) is based on your home base and join date.
                    </div>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 MULTI-VIEWS PANEL — THE MOAT
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-views">
                <div class="panel-header">
                    <h1 class="panel-title">Multi-Views</h1>
                    <p class="panel-subtitle">One profile. Different contexts. You control what they see.</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Your Views</span>
                        <span class="card-badge">4 active</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--ink-soft); margin-bottom: 1rem;">
                        Create different versions of your profile for different audiences. Share a specific URL for each context.
                    </p>
                    
                    <div class="views-list" id="views-list">
                        <!-- View: Social -->
                        <div class="view-item" data-view="social" data-visibility="public">
                            <div class="view-item-header" onclick="toggleViewExpand('social')">
                                <div class="view-drag-handle">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><circle cx="5" cy="6" r="2"/><circle cx="12" cy="6" r="2"/><circle cx="19" cy="6" r="2"/><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/><circle cx="5" cy="18" r="2"/><circle cx="12" cy="18" r="2"/><circle cx="19" cy="18" r="2"/></svg>
                                </div>
                                <div class="view-icon" style="background: #E8F5E9; color: #2E7D5A;">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                                </div>
                                <div class="view-info">
                                    <div class="view-name">Social</div>
                                    <div class="view-url">myoolala.com/sofia<strong>/social</strong></div>
                                </div>
                                <div class="view-meta">
                                    <span class="view-visibility-badge public">Public</span>
                                    <span class="view-stat">4 links</span>
                                </div>
                                <div class="view-actions" onclick="event.stopPropagation()">
                                    <button class="view-action-btn" onclick="copyViewUrl('social')" title="Copy URL">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    </button>
                                    <button class="view-action-btn expand-indicator">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="view-item-expanded">
                                <div class="view-visibility-toggle">
                                    <span class="view-visibility-label">Visibility</span>
                                    <div class="visibility-switch" data-view="social">
                                        <button class="visibility-btn active" data-value="public" onclick="setViewVisibility('social', 'public')">Public</button>
                                        <button class="visibility-btn" data-value="private_link" onclick="setViewVisibility('social', 'private_link')">By invitation</button>
                                    </div>
                                </div>
                                <p class="view-visibility-hint" data-view="social">Anyone with the link — or who guesses it — can open this view.</p>
                                <div class="view-quick-actions">
                                    <button class="btn btn-sm btn-secondary" onclick="copyViewUrl('social')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                        Copy link
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="showQR('social')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                                        QR Code
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="previewView('social')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                        Preview
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- View: Work (By invitation par défaut) -->
                        <div class="view-item" data-view="work" data-visibility="private_link">
                            <div class="view-item-header" onclick="toggleViewExpand('work')">
                                <div class="view-drag-handle">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><circle cx="5" cy="6" r="2"/><circle cx="12" cy="6" r="2"/><circle cx="19" cy="6" r="2"/><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/><circle cx="5" cy="18" r="2"/><circle cx="12" cy="18" r="2"/><circle cx="19" cy="18" r="2"/></svg>
                                </div>
                                <div class="view-icon" style="background: #E3F2FD; color: #1565C0;">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                                </div>
                                <div class="view-info">
                                    <div class="view-name">Work</div>
                                    <div class="view-url view-url-private">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                                        By invitation only
                                    </div>
                                </div>
                                <div class="view-meta">
                                    <span class="view-visibility-badge private">By invitation</span>
                                    <span class="view-stat">3 links</span>
                                </div>
                                <div class="view-actions" onclick="event.stopPropagation()">
                                    <button class="view-action-btn" onclick="copyViewUrl('work')" title="Copy URL">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    </button>
                                    <button class="view-action-btn expand-indicator">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="view-item-expanded">
                                <div class="view-visibility-toggle">
                                    <span class="view-visibility-label">Visibility</span>
                                    <div class="visibility-switch" data-view="work">
                                        <button class="visibility-btn" data-value="public" onclick="setViewVisibility('work', 'public')">Public</button>
                                        <button class="visibility-btn active" data-value="private_link" onclick="setViewVisibility('work', 'private_link')">By invitation</button>
                                    </div>
                                </div>
                                <p class="view-visibility-hint" data-view="work">Only people with your shared link can open this view. The standard URL won't work.</p>
                                
                                <!-- Permanent link for private views -->
                                <div class="view-permanent-link">
                                    <span class="view-permanent-label">Permanent link (saved in wallets)</span>
                                    <div class="view-permanent-row">
                                        <code>myoolala.com/sofia/v/Kp7mQ9x</code>
                                        <button class="copy-mini-btn" onclick="copyPermanentLink('work')">Copy</button>
                                    </div>
                                </div>

                                <div class="view-quick-actions">
                                    <button class="btn btn-sm btn-secondary" onclick="copyPermanentLink('work')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                        Copy link
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="showQR('work')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                                        QR Code
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="previewView('work')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                        Preview
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- View: Events -->
                        <div class="view-item" data-view="events" data-visibility="public">
                            <div class="view-item-header" onclick="toggleViewExpand('events')">
                                <div class="view-drag-handle">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><circle cx="5" cy="6" r="2"/><circle cx="12" cy="6" r="2"/><circle cx="19" cy="6" r="2"/><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/><circle cx="5" cy="18" r="2"/><circle cx="12" cy="18" r="2"/><circle cx="19" cy="18" r="2"/></svg>
                                </div>
                                <div class="view-icon" style="background: #FFF3E0; color: #E65100;">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                                </div>
                                <div class="view-info">
                                    <div class="view-name">Events</div>
                                    <div class="view-url">myoolala.com/sofia<strong>/events</strong></div>
                                </div>
                                <div class="view-meta">
                                    <span class="view-visibility-badge public">Public</span>
                                    <span class="view-stat">3 links</span>
                                </div>
                                <div class="view-actions" onclick="event.stopPropagation()">
                                    <button class="view-action-btn" onclick="copyViewUrl('events')" title="Copy URL">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    </button>
                                    <button class="view-action-btn expand-indicator">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="view-item-expanded">
                                <div class="view-visibility-toggle">
                                    <span class="view-visibility-label">Visibility</span>
                                    <div class="visibility-switch" data-view="events">
                                        <button class="visibility-btn active" data-value="public" onclick="setViewVisibility('events', 'public')">Public</button>
                                        <button class="visibility-btn" data-value="private_link" onclick="setViewVisibility('events', 'private_link')">By invitation</button>
                                    </div>
                                </div>
                                <p class="view-visibility-hint" data-view="events">Anyone with the link — or who guesses it — can open this view.</p>
                                <div class="view-quick-actions">
                                    <button class="btn btn-sm btn-secondary" onclick="copyViewUrl('events')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                        Copy link
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="showQR('events')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                                        QR Code
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="previewView('events')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                        Preview
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- View: Exclusive (By invitation par défaut) -->
                        <div class="view-item" data-view="exclusive" data-visibility="private_link">
                            <div class="view-item-header" onclick="toggleViewExpand('exclusive')">
                                <div class="view-drag-handle">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><circle cx="5" cy="6" r="2"/><circle cx="12" cy="6" r="2"/><circle cx="19" cy="6" r="2"/><circle cx="5" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="19" cy="12" r="2"/><circle cx="5" cy="18" r="2"/><circle cx="12" cy="18" r="2"/><circle cx="19" cy="18" r="2"/></svg>
                                </div>
                                <div class="view-icon" style="background: var(--signature); color: #FAF9F6;">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                </div>
                                <div class="view-info">
                                    <div class="view-name">Exclusive <span class="view-vip-badge">VIP</span></div>
                                    <div class="view-url view-url-private">
                                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                                        By invitation only
                                    </div>
                                </div>
                                <div class="view-meta">
                                    <span class="view-visibility-badge private">By invitation</span>
                                    <span class="view-stat">2 links</span>
                                </div>
                                <div class="view-actions" onclick="event.stopPropagation()">
                                    <button class="view-action-btn" onclick="copyViewUrl('exclusive')" title="Copy URL">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                    </button>
                                    <button class="view-action-btn expand-indicator">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div class="view-item-expanded">
                                <div class="view-visibility-toggle">
                                    <span class="view-visibility-label">Visibility</span>
                                    <div class="visibility-switch" data-view="exclusive">
                                        <button class="visibility-btn" data-value="public" onclick="setViewVisibility('exclusive', 'public')">Public</button>
                                        <button class="visibility-btn active" data-value="private_link" onclick="setViewVisibility('exclusive', 'private_link')">By invitation</button>
                                    </div>
                                </div>
                                <p class="view-visibility-hint" data-view="exclusive">Only people with your shared link can open this view. The standard URL won't work.</p>
                                
                                <!-- Permanent link -->
                                <div class="view-permanent-link">
                                    <span class="view-permanent-label">Permanent link (saved in wallets)</span>
                                    <div class="view-permanent-row">
                                        <code>myoolala.com/sofia/v/x7k9m2p3</code>
                                        <button class="copy-mini-btn" onclick="copyPermanentLink('exclusive')">Copy</button>
                                    </div>
                                </div>

                                <!-- Aliases -->
                                <div class="view-aliases-section">
                                    <span class="view-aliases-label">Active aliases</span>
                                    <div class="alias-list" id="exclusive-alias-list">
                                        <div class="alias-item" data-status="active">
                                            <div class="alias-input-row">
                                                <span class="alias-prefix">myoolala.com/sofia/</span>
                                                <input type="text" class="alias-input" value="inner-circle" 
                                                       oninput="validateAliasInput(this)" 
                                                       onblur="validateAliasInput(this); markUnsaved()">
                                            </div>
                                            <div class="alias-actions">
                                                <button class="alias-copy-btn" onclick="copyAliasFromInput(this)" title="Copy">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                                </button>
                                                <button class="alias-delete-btn" onclick="revokeAlias(this)" title="Revoke">
                                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="add-alias-btn" onclick="addAlias('exclusive')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                                        Add alias
                                    </button>
                                </div>

                                <div class="view-quick-actions">
                                    <button class="btn btn-sm btn-secondary" onclick="copyPermanentLink('exclusive')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                                        Copy link
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="showQR('exclusive')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                                        QR Code
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="previewView('exclusive')">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                        Preview
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button class="add-item-btn" style="margin-top: 1rem;" onclick="openModal('add-view-modal')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Create New View
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Default View</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--ink-soft); margin-bottom: 1rem;">
                        When someone visits your main URL (myoolala.com/sofia), which view do they see?
                    </p>
                    <div class="default-view-selector">
                        <select class="form-input" id="default-view" onchange="setDefaultView(this.value)">
                            <option value="social" selected>Social — For friends & followers</option>
                            <option value="work">Work — For professional contacts</option>
                            <option value="events">Events — For conferences & meetups</option>
                            <option value="exclusive">Exclusive — For special connections</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Quick Share</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--ink-soft); margin-bottom: 1rem;">
                        Copy the right URL for your audience.
                    </p>
                    <div class="quick-share-grid">
                        <button class="quick-share-btn" onclick="copyViewUrl('social')">
                            <span class="quick-share-icon" style="background: #E8F5E9; color: #2E7D5A;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            </span>
                            <span class="quick-share-label">Social</span>
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                        </button>
                        <button class="quick-share-btn" onclick="copyViewUrl('work')">
                            <span class="quick-share-icon" style="background: #E3F2FD; color: #1565C0;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                            </span>
                            <span class="quick-share-label">Work</span>
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                        </button>
                        <button class="quick-share-btn" onclick="copyViewUrl('events')">
                            <span class="quick-share-icon" style="background: #FFF3E0; color: #E65100;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                            </span>
                            <span class="quick-share-label">Events</span>
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                        </button>
                        <button class="quick-share-btn" onclick="copyViewUrl('exclusive')">
                            <span class="quick-share-icon" style="background: var(--signature); color: #FAF9F6;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                            </span>
                            <span class="quick-share-label">Exclusive</span>
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                        </button>
                    </div>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 SPOTLIGHT PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-spotlight">
                <div class="panel-header">
                    <h1 class="panel-title">Spotlight</h1>
                    <p class="panel-subtitle">Your moment to shine</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Spotlight Quote</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--ink-soft); margin-bottom: 1rem;">
                        A short phrase that appears prominently on your profile. Make it memorable.
                    </p>
                    <div class="form-group">
                        <textarea class="form-input" id="input-spotlight" placeholder="The journey is the destination..." maxlength="80" onchange="markUnsaved()"></textarea>
                        <div class="form-hint">
                            <span class="char-count"><span id="spotlight-count">0</span>/80</span>
                        </div>
                    </div>
                    <div class="spotlight-preview">
                        <div class="spotlight-preview-title">Preview</div>
                        <div class="spotlight-quote" id="spotlight-preview-text">"The journey is the destination..."</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Featured Content</span>
                        <span class="card-badge pro">PRO</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--ink-soft); margin-bottom: 1rem;">
                        Pin your best content to the spotlight section of your profile.
                    </p>
                    <button class="add-item-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Featured Content
                    </button>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 LINKS PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-links">
                <div class="panel-header">
                    <h1 class="panel-title">Links</h1>
                    <p class="panel-subtitle">Your curated collection</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Your Links</span>
                        <span class="card-badge" id="links-count">0 links</span>
                    </div>
                    <div class="sortable-list" id="links-list">
                        <!-- Links populated dynamically -->
                    </div>
                    <button class="add-item-btn" style="margin-top: 1rem;" onclick="openModal('add-link-modal')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Link
                    </button>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 SOCIALS PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-socials">
                <div class="panel-header">
                    <h1 class="panel-title">Socials & Contact</h1>
                    <p class="panel-subtitle">How people can reach you</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Social Profiles</span>
                    </div>
                    <div class="social-grid">
                        <div class="social-input-group">
                            <label class="social-input-label">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
                                Instagram
                            </label>
                            <input type="text" class="social-input" placeholder="@username" id="social-instagram" onchange="markUnsaved()">
                        </div>
                        <div class="social-input-group">
                            <label class="social-input-label">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                                X / Twitter
                            </label>
                            <input type="text" class="social-input" placeholder="@username" id="social-twitter" onchange="markUnsaved()">
                        </div>
                        <div class="social-input-group">
                            <label class="social-input-label">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/></svg>
                                TikTok
                            </label>
                            <input type="text" class="social-input" placeholder="@username" id="social-tiktok" onchange="markUnsaved()">
                        </div>
                        <div class="social-input-group">
                            <label class="social-input-label">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                                LinkedIn
                            </label>
                            <input type="text" class="social-input" placeholder="/in/username" id="social-linkedin" onchange="markUnsaved()">
                        </div>
                        <div class="social-input-group">
                            <label class="social-input-label">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                                YouTube
                            </label>
                            <input type="text" class="social-input" placeholder="@channel" id="social-youtube" onchange="markUnsaved()">
                        </div>
                        <div class="social-input-group">
                            <label class="social-input-label">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
                                GitHub
                            </label>
                            <input type="text" class="social-input" placeholder="@username" id="social-github" onchange="markUnsaved()">
                        </div>
                        <div class="social-input-group">
                            <label class="social-input-label">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
                                Facebook
                            </label>
                            <input type="text" class="social-input" placeholder="@username" id="social-facebook" onchange="markUnsaved()">
                        </div>
                        <div class="social-input-group">
                            <label class="social-input-label">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12.785 16.241s.288-.035.436-.21c.136-.16.132-.46.132-.46s-.02-1.407.632-1.615c.646-.204 1.476 1.36 2.357 1.962.667.456 1.173.356 1.173.356l2.36-.033s1.234-.077.649-.99c-.048-.075-.341-.669-1.753-1.893-1.478-1.282-1.28-1.074.5-3.287.862-1.138 1.248-1.833 1.135-2.13-.107-.282-.77-.208-.77-.208l-2.654.017s-.197-.027-.343.06c-.143.087-.235.29-.235.29s-.422 1.124-.987 2.08c-1.19 2.012-1.666 2.12-1.86 1.993-.45-.295-.337-1.186-.337-1.82 0-1.977.3-2.802-.583-3.017-.294-.072-.509-.12-1.26-.127-.962-.01-1.777.003-2.238.23-.307.15-.543.486-.4.505.178.023.58.109.794.398.276.373.266 1.213.266 1.213s.158 2.327-.37 2.615c-.362.197-.858-.205-1.923-2.037-.543-.94-.954-1.978-.954-1.978s-.08-.196-.221-.3c-.172-.126-.412-.167-.412-.167l-2.524.017s-.378.01-.517.175c-.124.147-.01.451-.01.451s1.99 4.657 4.245 7.005c2.066 2.15 4.41 2.006 4.41 2.006h1.063z"/></svg>
                                VK
                            </label>
                            <input type="text" class="social-input" placeholder="@username" id="social-vk" onchange="markUnsaved()">
                        </div>
                        <div class="social-input-group">
                            <label class="social-input-label">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.326.326 0 0 0 .167-.054l1.903-1.114a.864.864 0 0 1 .717-.098 10.16 10.16 0 0 0 2.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348zM5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178 1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18zm5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826 0 1.622-.12 2.361-.336a.722.722 0 0 1 .598.082l1.584.926a.272.272 0 0 0 .14.047c.134 0 .24-.111.24-.247 0-.06-.023-.12-.038-.177l-.327-1.233a.582.582 0 0 1-.023-.156.49.49 0 0 1 .201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.97-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.969-.982z"/></svg>
                                WeChat
                            </label>
                            <input type="text" class="social-input" placeholder="ID" id="social-wechat" onchange="markUnsaved()">
                        </div>
                    </div>
                    <button class="add-item-btn" style="margin-top: 1rem;" onclick="openModal('add-social-modal')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Custom Social
                    </button>
                </div>

                <!-- Phone Numbers Card -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Phone Numbers</span>
                    </div>
                    <div class="contact-list" id="phones-list">
                        <div class="contact-item">
                            <div class="contact-item-info">
                                <input type="text" class="contact-input phone-number" placeholder="+1 234 567 8900" onchange="markUnsaved()">
                                <input type="text" class="contact-input phone-label" placeholder="Label (e.g. Personal, Work, WhatsApp...)" onchange="markUnsaved()">
                            </div>
                            <button class="contact-item-delete" onclick="this.parentElement.remove(); markUnsaved();">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                            </button>
                        </div>
                    </div>
                    <button class="add-item-btn btn-sm" style="margin-top: 0.75rem;" onclick="addPhone()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Phone Number
                    </button>
                    <div class="form-hint">Add any label: Personal, Work, WhatsApp, Telegram, Signal...</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Contact Methods</span>
                    </div>
                    
                    <!-- Email addresses -->
                    <div class="form-group">
                        <label class="form-label">Email Addresses</label>
                        <div class="contact-list" id="emails-list">
                            <!-- Emails populated dynamically -->
                        </div>
                        <button class="add-item-btn btn-sm" style="margin-top: 0.5rem;" onclick="addEmail()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            Add Email
                        </button>
                        <div class="form-hint">Examples: General, Booking, Press, Business</div>
                    </div>

                    <!-- Messaging apps -->
                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label class="form-label">Messaging Apps</label>
                        <div class="contact-list" id="messaging-list">
                            <!-- Messaging apps populated dynamically -->
                        </div>
                        <button class="add-item-btn btn-sm" style="margin-top: 0.5rem;" onclick="addMessaging()">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            Add Messaging
                        </button>
                    </div>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 SHOP PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-shop">
                <div class="panel-header">
                    <h1 class="panel-title">Shop</h1>
                    <p class="panel-subtitle">Sell your products and digital goods</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Products</span>
                        <span class="card-badge pro">PRO</span>
                    </div>
                    <div class="sortable-list" id="products-list">
                        <!-- Products populated dynamically -->
                    </div>
                    <button class="add-item-btn" style="margin-top: 1rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Product
                    </button>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 LOCKED CONTENT PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-locked">
                <div class="panel-header">
                    <h1 class="panel-title">Locked Content</h1>
                    <p class="panel-subtitle">Exclusive content for paying supporters</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Gated Content</span>
                        <span class="card-badge pro">PRO</span>
                    </div>
                    <div class="sortable-list" id="locked-list">
                        <!-- Locked content populated dynamically -->
                    </div>
                    <button class="add-item-btn" style="margin-top: 1rem;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Locked Content
                    </button>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 MUSIC PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-music">
                <div class="panel-header">
                    <h1 class="panel-title">Music</h1>
                    <p class="panel-subtitle">Share your sound</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Music Platforms</span>
                    </div>
                    <div class="integration-grid">
                        <div class="integration-item">
                            <div class="integration-icon spotify">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg>
                            </div>
                            <div class="integration-info">
                                <span class="integration-name">Spotify</span>
                                <input type="url" class="integration-input" placeholder="Playlist or profile URL" id="input-spotify" onchange="markUnsaved()">
                            </div>
                        </div>
                        <div class="integration-item">
                            <div class="integration-icon deezer">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.81 4.16v3.03H24V4.16h-5.19zM6.27 8.38v3.027h5.189V8.38h-5.19zm12.54 0v3.027H24V8.38h-5.19zM6.27 12.594v3.027h5.189v-3.027h-5.19zm6.27 0v3.027h5.19v-3.027h-5.19zm6.27 0v3.027H24v-3.027h-5.19zM0 16.81v3.029h5.19v-3.03H0zm6.27 0v3.029h5.189v-3.03h-5.19zm6.27 0v3.029h5.19v-3.03h-5.19zm6.27 0v3.029H24v-3.03h-5.19z"/></svg>
                            </div>
                            <div class="integration-info">
                                <span class="integration-name">Deezer</span>
                                <input type="url" class="integration-input" placeholder="Playlist or profile URL" id="input-deezer" onchange="markUnsaved()">
                            </div>
                        </div>
                        <div class="integration-item">
                            <div class="integration-icon youtube-music">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.376 0 0 5.376 0 12s5.376 12 12 12 12-5.376 12-12S18.624 0 12 0zm0 19.104c-3.924 0-7.104-3.18-7.104-7.104S8.076 4.896 12 4.896s7.104 3.18 7.104 7.104-3.18 7.104-7.104 7.104zm0-13.332c-3.432 0-6.228 2.796-6.228 6.228S8.568 18.228 12 18.228s6.228-2.796 6.228-6.228S15.432 5.772 12 5.772zM9.684 15.54V8.46L15.816 12l-6.132 3.54z"/></svg>
                            </div>
                            <div class="integration-info">
                                <span class="integration-name">YouTube Music</span>
                                <input type="url" class="integration-input" placeholder="Playlist or channel URL" id="input-youtube-music" onchange="markUnsaved()">
                            </div>
                        </div>
                        <div class="integration-item">
                            <div class="integration-icon apple-music">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M23.994 6.124a9.23 9.23 0 00-.24-2.19c-.317-1.31-1.062-2.31-2.18-3.043a5.022 5.022 0 00-1.877-.726 10.496 10.496 0 00-1.564-.15c-.04-.003-.083-.01-.124-.013H5.986c-.152.01-.303.017-.455.026-.747.043-1.49.123-2.193.401-1.336.53-2.3 1.452-2.865 2.78-.192.448-.292.925-.363 1.408-.056.392-.088.785-.1 1.18 0 .032-.007.062-.01.093v12.223c.01.14.017.283.027.424.05.815.154 1.624.497 2.373.65 1.42 1.738 2.353 3.234 2.801.42.127.856.187 1.293.228.555.053 1.11.06 1.667.06h11.03a12.5 12.5 0 001.57-.1c.822-.106 1.596-.35 2.295-.81a5.046 5.046 0 001.88-2.207c.186-.42.293-.87.37-1.324.113-.675.138-1.358.137-2.04-.002-3.8 0-7.595-.003-11.393zm-6.423 3.99v5.712c0 .417-.058.827-.244 1.206-.29.59-.76.962-1.388 1.14-.35.1-.706.157-1.07.173-.95.042-1.785-.455-2.105-1.245-.38-.94.093-2.07 1.082-2.515.344-.153.718-.24 1.084-.3.36-.06.725-.1 1.08-.202.29-.083.484-.245.552-.547.012-.052.02-.108.02-.163V8.373c0-.2-.065-.3-.27-.335-.39-.067-.78-.13-1.17-.196l-3.59-.597c-.285-.048-.57-.097-.855-.142-.165-.026-.27.04-.3.206-.008.043-.012.088-.012.133v7.935c0 .407-.05.807-.222 1.18-.293.622-.784 1.022-1.45 1.205-.347.1-.7.16-1.062.18-.945.06-1.808-.41-2.148-1.16-.408-.906.03-2.03.974-2.508.345-.176.72-.27 1.096-.337.35-.063.703-.11 1.05-.19.32-.077.528-.26.59-.59.007-.037.013-.078.013-.117V5.903c0-.106.02-.212.063-.31.07-.162.198-.256.372-.283.168-.027.337-.048.507-.07l4.213-.698c.882-.146 1.764-.292 2.646-.436.27-.043.54-.087.813-.122.226-.03.317.06.317.288.002 1.947.002 3.893.002 5.84z"/></svg>
                            </div>
                            <div class="integration-info">
                                <span class="integration-name">Apple Music</span>
                                <input type="url" class="integration-input" placeholder="Playlist URL" id="input-apple-music" onchange="markUnsaved()">
                            </div>
                        </div>
                        <div class="integration-item">
                            <div class="integration-icon soundcloud">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M1.175 12.225c-.051 0-.094.046-.101.1l-.233 2.154.233 2.105c.007.058.05.098.101.098.05 0 .09-.04.099-.098l.255-2.105-.27-2.154c-.009-.06-.052-.1-.1-.1m-.899.828c-.06 0-.091.037-.104.094L0 14.479l.165 1.308c.014.057.045.094.09.094s.089-.037.099-.094l.19-1.308-.19-1.334c-.01-.057-.044-.09-.09-.09m1.83-1.229c-.061 0-.12.045-.12.104l-.21 2.563.225 2.458c0 .06.045.104.106.104.061 0 .12-.044.12-.104l.24-2.458-.24-2.563c0-.06-.059-.104-.12-.104m.945-.089c-.075 0-.135.06-.15.135l-.193 2.64.21 2.544c.016.077.075.138.149.138.075 0 .135-.061.15-.138l.225-2.544-.225-2.64c-.015-.075-.075-.135-.15-.135m.93-.179c-.09 0-.149.075-.165.164l-.18 2.819.18 2.553c.016.09.075.164.165.164.09 0 .164-.074.164-.164l.21-2.553-.21-2.819c0-.089-.074-.164-.164-.164m.96-.21c-.105 0-.18.09-.195.194l-.165 3.029.18 2.563c.015.105.09.18.195.18.104 0 .194-.075.194-.18l.195-2.563-.195-3.029c-.015-.105-.09-.194-.194-.194m.989-.194c-.12 0-.209.104-.224.224l-.15 3.194.15 2.563c.015.12.105.21.224.21.12 0 .21-.09.224-.21l.166-2.563-.165-3.194c-.015-.12-.105-.224-.225-.224m1.005-.18c-.135 0-.239.105-.254.24l-.135 3.36.135 2.548c.015.135.12.24.254.24.135 0 .225-.105.254-.24l.15-2.549-.15-3.36c-.029-.135-.119-.24-.254-.24m1.021-.15c-.15 0-.254.12-.27.27l-.119 3.509.12 2.534c.015.15.12.27.27.27.135 0 .255-.12.27-.27l.135-2.534-.135-3.509c-.014-.15-.135-.27-.27-.27m1.036-.165c-.165 0-.284.135-.3.3l-.105 3.659.105 2.519c.016.165.135.3.3.3.164 0 .284-.135.3-.3l.12-2.519-.12-3.659c-.016-.165-.136-.3-.3-.3m1.049-.104c-.18 0-.3.149-.315.329l-.09 3.809.09 2.503c.015.165.135.315.315.315.18 0 .314-.15.314-.315l.12-2.503-.12-3.809c0-.18-.135-.329-.314-.329m1.08-.075c-.194 0-.33.164-.344.359l-.075 3.884.075 2.489c.015.194.15.359.345.359.194 0 .329-.165.359-.359l.075-2.489-.075-3.884c-.03-.195-.165-.359-.36-.359m1.065-.045c-.21 0-.359.18-.374.39l-.06 3.929.06 2.475c.015.21.165.389.375.389.195 0 .359-.18.374-.389l.075-2.475-.075-3.929c-.015-.21-.179-.39-.375-.39m1.095-.014c-.225 0-.375.195-.39.42l-.045 3.958.045 2.46c.015.224.165.42.39.42.21 0 .375-.195.39-.42l.06-2.46-.06-3.958c-.015-.225-.18-.42-.39-.42m1.095.021c-.225 0-.39.209-.405.434l-.03 3.922.03 2.46c.015.225.18.434.405.434.225 0 .39-.209.405-.434l.045-2.46-.045-3.922c-.015-.225-.18-.434-.405-.434m1.11.014c-.24 0-.405.225-.42.464l-.015 3.908.015 2.444c.015.239.18.449.42.449.24 0 .405-.21.42-.449l.03-2.444-.03-3.908c-.015-.239-.18-.464-.42-.464m1.635 1.229c-.18 0-.33.044-.48.104-.18-.975-.999-1.71-2.009-1.71-.27 0-.525.06-.765.164-.09.045-.119.089-.119.18v7.484c0 .09.06.165.149.18.015 0 3.164.015 3.224.015 1.125 0 2.039-.9 2.039-2.025s-.914-2.393-2.039-2.393"/></svg>
                            </div>
                            <div class="integration-info">
                                <span class="integration-name">SoundCloud</span>
                                <input type="url" class="integration-input" placeholder="Profile or track URL" id="input-soundcloud" onchange="markUnsaved()">
                            </div>
                        </div>
                    </div>
                    <button class="add-item-btn" style="margin-top: 1rem;" onclick="oolalaToast('More platforms coming soon')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Request Another Platform
                    </button>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 SPORT & HEALTH PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-sport">
                <div class="panel-header">
                    <h1 class="panel-title">Sport & Health</h1>
                    <p class="panel-subtitle">Share your active lifestyle</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Fitness & Activity</span>
                    </div>
                    <div class="integration-grid">
                        <div class="integration-item">
                            <div class="integration-icon strava">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.598h4.172L10.463 0l-7 13.828h4.169"/></svg>
                            </div>
                            <div class="integration-info">
                                <span class="integration-name">Strava</span>
                                <input type="url" class="integration-input" placeholder="Profile URL" id="input-strava" onchange="markUnsaved()">
                            </div>
                        </div>
                        <div class="integration-item">
                            <div class="integration-icon playtomic">
                                <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/></svg>
                            </div>
                            <div class="integration-info">
                                <span class="integration-name">Playtomic</span>
                                <input type="text" class="integration-input" placeholder="@username" id="input-playtomic" onchange="markUnsaved()">
                            </div>
                        </div>
                        <div class="integration-item">
                            <div class="integration-icon whoop">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
                            </div>
                            <div class="integration-info">
                                <span class="integration-name">Whoop</span>
                                <input type="text" class="integration-input" placeholder="Username" id="input-whoop" onchange="markUnsaved()">
                            </div>
                        </div>
                        <div class="integration-item">
                            <div class="integration-icon garmin">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 22.5C6.201 22.5 1.5 17.799 1.5 12S6.201 1.5 12 1.5 22.5 6.201 22.5 12 17.799 22.5 12 22.5zm0-19.5C7.029 3 3 7.029 3 12s4.029 9 9 9 9-4.029 9-9-4.029-9-9-9z"/></svg>
                            </div>
                            <div class="integration-info">
                                <span class="integration-name">Garmin Connect</span>
                                <input type="url" class="integration-input" placeholder="Profile URL" id="input-garmin" onchange="markUnsaved()">
                            </div>
                        </div>
                    </div>
                    <button class="add-item-btn" style="margin-top: 1rem;" onclick="oolalaToast('More platforms coming soon')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Request Another Platform
                    </button>
                </div>

                <div class="card" style="margin-top: 1rem; background: var(--surface); border: 1px dashed rgba(0,0,0,0.1);">
                    <div class="card-header">
                        <span class="card-title" style="color: var(--ink-soft);">Coming Soon</span>
                    </div>
                    <p style="font-size: 0.85rem; color: var(--ink-soft);">
                        More integrations planned: Nike Run Club, Peloton, MyFitnessPal, Fitbit...
                    </p>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 ANALYTICS PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-analytics">
                <div class="panel-header">
                    <h1 class="panel-title">Analytics</h1>
                    <p class="panel-subtitle">Understand your audience</p>
                </div>

                <!-- Period Selector -->
                <div class="analytics-period">
                    <button class="period-btn active" data-period="7d">7 days</button>
                    <button class="period-btn" data-period="30d">30 days</button>
                    <button class="period-btn" data-period="90d">90 days</button>
                    <button class="period-btn pro-only" data-period="12m">12 months</button>
                </div>

                <!-- Overview Stats — FREE -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Overview</span>
                        <span class="card-badge">Free</span>
                    </div>
                    <div class="analytics-grid">
                        <div class="analytics-stat">
                            <div class="analytics-stat-value" id="analytics-views">2,847</div>
                            <div class="analytics-stat-label">Profile Views</div>
                            <div class="analytics-stat-change positive">+12.5%</div>
                        </div>
                        <div class="analytics-stat">
                            <div class="analytics-stat-value" id="analytics-clicks">892</div>
                            <div class="analytics-stat-label">Link Clicks</div>
                            <div class="analytics-stat-change positive">+8.2%</div>
                        </div>
                        <div class="analytics-stat">
                            <div class="analytics-stat-value" id="analytics-ctr">31.3%</div>
                            <div class="analytics-stat-label">Click Rate</div>
                            <div class="analytics-stat-change negative">-2.1%</div>
                        </div>
                        <div class="analytics-stat">
                            <div class="analytics-stat-value" id="analytics-unique">1,923</div>
                            <div class="analytics-stat-label">Unique Visitors</div>
                            <div class="analytics-stat-change positive">+15.7%</div>
                        </div>
                    </div>
                </div>

                <!-- Mini Chart — FREE -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Traffic Trend</span>
                    </div>
                    <div class="analytics-chart-mini">
                        <div class="chart-bars">
                            <div class="chart-bar" style="height: 45%;" title="Mon: 312"></div>
                            <div class="chart-bar" style="height: 62%;" title="Tue: 428"></div>
                            <div class="chart-bar" style="height: 38%;" title="Wed: 267"></div>
                            <div class="chart-bar" style="height: 71%;" title="Thu: 492"></div>
                            <div class="chart-bar" style="height: 85%;" title="Fri: 589"></div>
                            <div class="chart-bar" style="height: 53%;" title="Sat: 367"></div>
                            <div class="chart-bar active" style="height: 58%;" title="Sun: 392"></div>
                        </div>
                        <div class="chart-labels">
                            <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
                        </div>
                    </div>
                </div>

                <!-- Top Links — FREE -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Top Links</span>
                    </div>
                    <div class="analytics-links-list">
                        <div class="analytics-link-item">
                            <div class="analytics-link-rank">1</div>
                            <div class="analytics-link-info">
                                <div class="analytics-link-title">YouTube Channel</div>
                                <div class="analytics-link-url">youtube.com/@sofiarey</div>
                            </div>
                            <div class="analytics-link-clicks">342 clicks</div>
                            <div class="analytics-link-bar"><div class="analytics-link-bar-fill" style="width: 100%;"></div></div>
                        </div>
                        <div class="analytics-link-item">
                            <div class="analytics-link-rank">2</div>
                            <div class="analytics-link-info">
                                <div class="analytics-link-title">Instagram</div>
                                <div class="analytics-link-url">instagram.com/sofiarey</div>
                            </div>
                            <div class="analytics-link-clicks">287 clicks</div>
                            <div class="analytics-link-bar"><div class="analytics-link-bar-fill" style="width: 84%;"></div></div>
                        </div>
                        <div class="analytics-link-item">
                            <div class="analytics-link-rank">3</div>
                            <div class="analytics-link-info">
                                <div class="analytics-link-title">The Sunday Edit</div>
                                <div class="analytics-link-url">thesundayedit.com</div>
                            </div>
                            <div class="analytics-link-clicks">156 clicks</div>
                            <div class="analytics-link-bar"><div class="analytics-link-bar-fill" style="width: 46%;"></div></div>
                        </div>
                    </div>
                </div>

                <!-- Geographic — FREE (Light) -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Top Countries</span>
                        <span class="card-badge">Top 5</span>
                    </div>
                    <div class="analytics-geo-list">
                        <div class="analytics-geo-item">
                            <span class="analytics-geo-flag">🇺🇸</span>
                            <span class="analytics-geo-country">United States</span>
                            <span class="analytics-geo-value">1,247</span>
                            <div class="analytics-geo-bar"><div class="analytics-geo-bar-fill" style="width: 100%;"></div></div>
                        </div>
                        <div class="analytics-geo-item">
                            <span class="analytics-geo-flag">🇲🇽</span>
                            <span class="analytics-geo-country">Mexico</span>
                            <span class="analytics-geo-value">523</span>
                            <div class="analytics-geo-bar"><div class="analytics-geo-bar-fill" style="width: 42%;"></div></div>
                        </div>
                        <div class="analytics-geo-item">
                            <span class="analytics-geo-flag">🇬🇧</span>
                            <span class="analytics-geo-country">United Kingdom</span>
                            <span class="analytics-geo-value">312</span>
                            <div class="analytics-geo-bar"><div class="analytics-geo-bar-fill" style="width: 25%;"></div></div>
                        </div>
                        <div class="analytics-geo-item">
                            <span class="analytics-geo-flag">🇨🇦</span>
                            <span class="analytics-geo-country">Canada</span>
                            <span class="analytics-geo-value">198</span>
                            <div class="analytics-geo-bar"><div class="analytics-geo-bar-fill" style="width: 16%;"></div></div>
                        </div>
                        <div class="analytics-geo-item">
                            <span class="analytics-geo-flag">🇦🇺</span>
                            <span class="analytics-geo-country">Australia</span>
                            <span class="analytics-geo-value">145</span>
                            <div class="analytics-geo-bar"><div class="analytics-geo-bar-fill" style="width: 12%;"></div></div>
                        </div>
                    </div>
                </div>

                <!-- ═══════════════════════════════════════════
                     PRO FEATURES — GRAYED OUT FOR FREE USERS
                     ═══════════════════════════════════════════ -->
                
                <!-- Geographic Deep Dive — PRO -->
                <div class="card pro-locked">
                    <div class="pro-overlay">
                        <div class="pro-lock-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        </div>
                        <div class="pro-lock-text">Pro Feature</div>
                        <button class="btn btn-primary btn-sm" onclick="upgradeToPro()">Upgrade to Pro</button>
                    </div>
                    <div class="card-header">
                        <span class="card-title">Geographic Deep Dive</span>
                        <span class="card-badge pro">PRO</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--ink-soft); margin-bottom: 1rem;">
                        Full world map visualization with city-level breakdown.
                    </p>
                    <div class="geo-stats-grid">
                        <div class="geo-stat">
                            <div class="geo-stat-country">🇺🇸 United States</div>
                            <div class="geo-stat-bar"><div class="geo-stat-fill" style="width: 42%"></div></div>
                            <div class="geo-stat-value">42%</div>
                        </div>
                        <div class="geo-stat">
                            <div class="geo-stat-country">🇬🇧 United Kingdom</div>
                            <div class="geo-stat-bar"><div class="geo-stat-fill" style="width: 18%"></div></div>
                            <div class="geo-stat-value">18%</div>
                        </div>
                        <div class="geo-stat">
                            <div class="geo-stat-country">🇦🇪 UAE</div>
                            <div class="geo-stat-bar"><div class="geo-stat-fill" style="width: 15%"></div></div>
                            <div class="geo-stat-value">15%</div>
                        </div>
                        <div class="geo-stat">
                            <div class="geo-stat-country">🇫🇷 France</div>
                            <div class="geo-stat-bar"><div class="geo-stat-fill" style="width: 12%"></div></div>
                            <div class="geo-stat-value">12%</div>
                        </div>
                        <div class="geo-stat">
                            <div class="geo-stat-country">🇩🇪 Germany</div>
                            <div class="geo-stat-bar"><div class="geo-stat-fill" style="width: 8%"></div></div>
                            <div class="geo-stat-value">8%</div>
                        </div>
                    </div>
                </div>

                <!-- Traffic Sources — PRO -->
                <div class="card pro-locked">
                    <div class="pro-overlay">
                        <div class="pro-lock-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        </div>
                        <div class="pro-lock-text">Pro Feature</div>
                        <button class="btn btn-primary btn-sm" onclick="upgradeToPro()">Upgrade to Pro</button>
                    </div>
                    <div class="card-header">
                        <span class="card-title">Traffic Sources</span>
                        <span class="card-badge pro">PRO</span>
                    </div>
                    <div class="analytics-sources-preview">
                        <div class="source-item">
                            <span class="source-icon">🔗</span>
                            <span class="source-name">Direct</span>
                            <div class="source-bar"><div class="source-fill" style="width: 45%"></div></div>
                            <span class="source-value">45%</span>
                        </div>
                        <div class="source-item">
                            <span class="source-icon">📸</span>
                            <span class="source-name">Instagram</span>
                            <div class="source-bar"><div class="source-fill" style="width: 28%"></div></div>
                            <span class="source-value">28%</span>
                        </div>
                        <div class="source-item">
                            <span class="source-icon">𝕏</span>
                            <span class="source-name">Twitter/X</span>
                            <div class="source-bar"><div class="source-fill" style="width: 15%"></div></div>
                            <span class="source-value">15%</span>
                        </div>
                        <div class="source-item">
                            <span class="source-icon">💼</span>
                            <span class="source-name">LinkedIn</span>
                            <div class="source-bar"><div class="source-fill" style="width: 12%"></div></div>
                            <span class="source-value">12%</span>
                        </div>
                    </div>
                </div>

                <!-- Device Breakdown — PRO -->
                <div class="card pro-locked">
                    <div class="pro-overlay">
                        <div class="pro-lock-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        </div>
                        <div class="pro-lock-text">Pro Feature</div>
                        <button class="btn btn-primary btn-sm" onclick="upgradeToPro()">Upgrade to Pro</button>
                    </div>
                    <div class="card-header">
                        <span class="card-title">Devices & Browsers</span>
                        <span class="card-badge pro">PRO</span>
                    </div>
                    <div class="analytics-devices-preview">
                        <div class="device-donut blurred"></div>
                        <div class="device-legend blurred">
                            <div class="device-legend-item"><span class="dot mobile"></span>Mobile 72%</div>
                            <div class="device-legend-item"><span class="dot desktop"></span>Desktop 24%</div>
                            <div class="device-legend-item"><span class="dot tablet"></span>Tablet 4%</div>
                        </div>
                    </div>
                </div>

                <!-- Real-time — PRO -->
                <div class="card pro-locked">
                    <div class="pro-overlay">
                        <div class="pro-lock-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        </div>
                        <div class="pro-lock-text">Pro Feature</div>
                        <button class="btn btn-primary btn-sm" onclick="upgradeToPro()">Upgrade to Pro</button>
                    </div>
                    <div class="card-header">
                        <span class="card-title">Real-time Activity</span>
                        <span class="card-badge pro">PRO</span>
                    </div>
                    <div class="realtime-preview blurred">
                        <div class="realtime-count">
                            <span class="realtime-pulse"></span>
                            <span class="realtime-number">7</span>
                            <span class="realtime-label">visitors right now</span>
                        </div>
                    </div>
                </div>

                <!-- Export & Plausible — PRO -->
                <div class="card pro-locked">
                    <div class="pro-overlay">
                        <div class="pro-lock-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        </div>
                        <div class="pro-lock-text">Pro Feature</div>
                        <button class="btn btn-primary btn-sm" onclick="upgradeToPro()">Upgrade to Pro</button>
                    </div>
                    <div class="card-header">
                        <span class="card-title">Advanced Tools</span>
                        <span class="card-badge pro">PRO</span>
                    </div>
                    <div class="advanced-tools-list">
                        <div class="advanced-tool blurred">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            <span>Export CSV / PDF reports</span>
                        </div>
                        <div class="advanced-tool blurred">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                            <span>Plausible full dashboard</span>
                        </div>
                        <div class="advanced-tool blurred">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            <span>Historical data (12 months)</span>
                        </div>
                        <div class="advanced-tool blurred">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                            <span>Conversion funnels</span>
                        </div>
                    </div>
                </div>

                <!-- Powered by Plausible -->
                <div class="analytics-footer">
                    <div class="plausible-badge">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        Privacy-first analytics powered by <strong>Plausible</strong>
                    </div>
                    <div class="plausible-note">No cookies. GDPR compliant. Your visitors' privacy respected.</div>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 RANKING PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-ranking">
                <div class="panel-header">
                    <h1 class="panel-title">Ranking</h1>
                    <p class="panel-subtitle">Your position in the myOolala community</p>
                </div>

                <!-- Your Global Position -->
                <div class="card ranking-hero-card">
                    <div class="ranking-hero">
                        <div class="ranking-position">
                            <span class="ranking-hash">#</span>
                            <span class="ranking-number" id="user-global-rank">847</span>
                        </div>
                        <div class="ranking-context">
                            <div class="ranking-label">Global Rank</div>
                            <div class="ranking-total">out of <strong>12,458</strong> citizens</div>
                            <div class="ranking-percentile">
                                <span class="percentile-badge">Top 7%</span>
                            </div>
                        </div>
                    </div>
                    <div class="ranking-movement">
                        <span class="movement-icon positive">↑</span>
                        <span class="movement-text">+23 positions this week</span>
                    </div>
                </div>

                <!-- Category Rankings — FREE -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Rankings by Category</span>
                        <span class="card-badge">Free</span>
                    </div>
                    <div class="ranking-categories">
                        <div class="ranking-category-item">
                            <div class="ranking-category-icon" style="background: #E8F5E9; color: #2E7D5A;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            </div>
                            <div class="ranking-category-info">
                                <div class="ranking-category-name">Views</div>
                                <div class="ranking-category-desc">Profile visibility</div>
                            </div>
                            <div class="ranking-category-rank">
                                <span class="rank-number">#312</span>
                                <span class="rank-change positive">↑ 45</span>
                            </div>
                        </div>
                        <div class="ranking-category-item">
                            <div class="ranking-category-icon" style="background: #E3F2FD; color: #1565C0;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
                            </div>
                            <div class="ranking-category-info">
                                <div class="ranking-category-name">Clicks</div>
                                <div class="ranking-category-desc">Link engagement</div>
                            </div>
                            <div class="ranking-category-rank">
                                <span class="rank-number">#589</span>
                                <span class="rank-change positive">↑ 12</span>
                            </div>
                        </div>
                        <div class="ranking-category-item">
                            <div class="ranking-category-icon" style="background: #FFF3E0; color: #E65100;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
                            </div>
                            <div class="ranking-category-info">
                                <div class="ranking-category-name">Growth</div>
                                <div class="ranking-category-desc">Weekly momentum</div>
                            </div>
                            <div class="ranking-category-rank">
                                <span class="rank-number">#156</span>
                                <span class="rank-change positive">↑ 78</span>
                            </div>
                        </div>
                        <div class="ranking-category-item">
                            <div class="ranking-category-icon" style="background: #FCE4EC; color: #C2185B;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                            </div>
                            <div class="ranking-category-info">
                                <div class="ranking-category-name">Engagement</div>
                                <div class="ranking-category-desc">Click-through rate</div>
                            </div>
                            <div class="ranking-category-rank">
                                <span class="rank-number">#423</span>
                                <span class="rank-change negative">↓ 8</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Leaderboard Top 10 — FREE -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Top 10 Leaderboard</span>
                        <div class="leaderboard-tabs">
                            <button class="leaderboard-tab active" data-lb="global">Global</button>
                            <button class="leaderboard-tab" data-lb="country">🇺🇸 USA</button>
                            <button class="leaderboard-tab" data-lb="weekly">This Week</button>
                        </div>
                    </div>
                    <div class="leaderboard-list">
                        <div class="leaderboard-item gold">
                            <div class="leaderboard-rank">1</div>
                            <div class="leaderboard-avatar">
                                <img src="https://i.pravatar.cc/40?img=1" alt="">
                            </div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">@alexandranova</div>
                                <div class="leaderboard-stats">45.2K views • 89% CTR</div>
                            </div>
                            <div class="leaderboard-score">9,847</div>
                        </div>
                        <div class="leaderboard-item silver">
                            <div class="leaderboard-rank">2</div>
                            <div class="leaderboard-avatar">
                                <img src="https://i.pravatar.cc/40?img=2" alt="">
                            </div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">@marcuskim</div>
                                <div class="leaderboard-stats">38.9K views • 82% CTR</div>
                            </div>
                            <div class="leaderboard-score">8,234</div>
                        </div>
                        <div class="leaderboard-item bronze">
                            <div class="leaderboard-rank">3</div>
                            <div class="leaderboard-avatar">
                                <img src="https://i.pravatar.cc/40?img=3" alt="">
                            </div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">@priyasharma</div>
                                <div class="leaderboard-stats">32.1K views • 78% CTR</div>
                            </div>
                            <div class="leaderboard-score">7,891</div>
                        </div>
                        <div class="leaderboard-item">
                            <div class="leaderboard-rank">4</div>
                            <div class="leaderboard-avatar">
                                <img src="https://i.pravatar.cc/40?img=4" alt="">
                            </div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">@lucasbernard</div>
                                <div class="leaderboard-stats">28.7K views • 74% CTR</div>
                            </div>
                            <div class="leaderboard-score">6,542</div>
                        </div>
                        <div class="leaderboard-item">
                            <div class="leaderboard-rank">5</div>
                            <div class="leaderboard-avatar">
                                <img src="https://i.pravatar.cc/40?img=5" alt="">
                            </div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">@emilywong</div>
                                <div class="leaderboard-stats">25.3K views • 71% CTR</div>
                            </div>
                            <div class="leaderboard-score">5,987</div>
                        </div>
                        <div class="leaderboard-divider">
                            <span>• • •</span>
                        </div>
                        <div class="leaderboard-item you">
                            <div class="leaderboard-rank">847</div>
                            <div class="leaderboard-avatar">
                                <img src="https://i.pravatar.cc/40?img=12" alt="">
                            </div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">@sofiarey <span class="you-badge">You</span></div>
                                <div class="leaderboard-stats">2.8K views • 31% CTR</div>
                            </div>
                            <div class="leaderboard-score">892</div>
                        </div>
                    </div>
                </div>

                <!-- Achievements / Badges — FREE -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Achievements</span>
                        <span class="badge-count">4/12 unlocked</span>
                    </div>
                    <div class="achievements-grid">
                        <div class="achievement unlocked">
                            <div class="achievement-icon">🚀</div>
                            <div class="achievement-name">First Launch</div>
                            <div class="achievement-desc">Created your profile</div>
                        </div>
                        <div class="achievement unlocked">
                            <div class="achievement-icon">👀</div>
                            <div class="achievement-name">Getting Noticed</div>
                            <div class="achievement-desc">1,000 profile views</div>
                        </div>
                        <div class="achievement unlocked">
                            <div class="achievement-icon">🔗</div>
                            <div class="achievement-name">Link Builder</div>
                            <div class="achievement-desc">Added 5+ links</div>
                        </div>
                        <div class="achievement unlocked">
                            <div class="achievement-icon">🌍</div>
                            <div class="achievement-name">Global Citizen</div>
                            <div class="achievement-desc">Set origin & location</div>
                        </div>
                        <div class="achievement locked">
                            <div class="achievement-icon">⭐</div>
                            <div class="achievement-name">Rising Star</div>
                            <div class="achievement-desc">Reach top 500</div>
                        </div>
                        <div class="achievement locked">
                            <div class="achievement-icon">💎</div>
                            <div class="achievement-name">Elite</div>
                            <div class="achievement-desc">Reach top 100</div>
                        </div>
                        <div class="achievement locked">
                            <div class="achievement-icon">🏆</div>
                            <div class="achievement-name">Champion</div>
                            <div class="achievement-desc">Reach top 10</div>
                        </div>
                        <div class="achievement locked">
                            <div class="achievement-icon">👑</div>
                            <div class="achievement-name">Legend</div>
                            <div class="achievement-desc">Reach #1 rank</div>
                        </div>
                    </div>
                </div>

                <!-- PRO Features -->
                <div class="card pro-locked">
                    <div class="pro-overlay">
                        <div class="pro-lock-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        </div>
                        <div class="pro-lock-text">Pro Feature</div>
                        <button class="btn btn-primary btn-sm" onclick="upgradeToPro()">Upgrade to Pro</button>
                    </div>
                    <div class="card-header">
                        <span class="card-title">Detailed Analytics</span>
                        <span class="card-badge pro">PRO</span>
                    </div>
                    <div class="pro-features-list">
                        <div class="pro-feature-item blurred">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
                            <span>Historical rank tracking</span>
                        </div>
                        <div class="pro-feature-item blurred">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            <span>Real-time position updates</span>
                        </div>
                        <div class="pro-feature-item blurred">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            <span>Competitor comparison</span>
                        </div>
                        <div class="pro-feature-item blurred">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                            <span>Exclusive PRO badges</span>
                        </div>
                    </div>
                </div>

                <!-- Ranking Footer -->
                <div class="ranking-footer">
                    <div class="ranking-info">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                        Rankings updated every 24 hours based on views, clicks, and engagement.
                    </div>
                </div>
            </section>

            <!-- ══════════════════════════════════════
                 SETTINGS PANEL
                 ══════════════════════════════════════ -->
            <section class="panel" id="panel-settings">
                <div class="panel-header">
                    <h1 class="panel-title">Settings</h1>
                    <p class="panel-subtitle">Account preferences</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Payment Methods</span>
                    </div>

                    <div class="payment-method">
                        <div class="payment-method-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                            <span class="payment-method-name">Stripe</span>
                            <span class="payment-status not-connected">Not connected</span>
                        </div>
                        <button class="btn btn-secondary btn-sm">Connect Stripe</button>
                    </div>

                    <div class="payment-method">
                        <div class="payment-method-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M7.076 21.337H2.47a.641.641 0 0 1-.633-.74L4.944.901C5.026.382 5.474 0 5.998 0h7.46c2.57 0 4.578.543 5.69 1.81 1.01 1.15 1.304 2.42 1.012 4.287-.023.143-.047.288-.077.437-.983 5.05-4.349 6.797-8.647 6.797h-2.19c-.524 0-.968.382-1.05.9l-1.12 7.106zm14.146-14.42a3.35 3.35 0 0 0-.607-.541c-.013.076-.026.175-.041.254-.93 4.778-4.005 7.201-9.138 7.201h-2.19a.563.563 0 0 0-.556.479l-1.187 7.527h-.506l-.24 1.516a.56.56 0 0 0 .554.647h3.882c.46 0 .85-.334.922-.788.06-.26.76-4.852.816-5.09a.932.932 0 0 1 .923-.788h.58c3.76 0 6.705-1.528 7.565-5.946.36-1.847.174-3.388-.777-4.471z"/></svg>
                            <span class="payment-method-name">PayPal</span>
                            <span class="payment-status not-connected">Not connected</span>
                        </div>
                        <button class="btn btn-secondary btn-sm">Connect PayPal</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Privacy</span>
                    </div>
                    <div class="toggle-row">
                        <div>
                            <div class="toggle-label">Public profile</div>
                            <div class="toggle-desc">Anyone with the link can view your page</div>
                        </div>
                        <div class="toggle active" data-toggle="public-profile"></div>
                    </div>
                    <div class="toggle-row">
                        <div>
                            <div class="toggle-label">Show in search engines</div>
                            <div class="toggle-desc">Allow Google to index your profile</div>
                        </div>
                        <div class="toggle active" data-toggle="seo-index"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Danger Zone</span>
                    </div>
                    <button class="btn btn-ghost" style="color: var(--error);">Delete Account</button>
                </div>
            </section>

        </main>

        <!-- Preview Panel -->
        <aside class="preview-panel">
            <div class="preview-header">
                <span class="preview-title">Live Preview</span>
                <div class="preview-controls">
                    <select class="preview-view-select" id="preview-view-select" onchange="switchPreviewView(this.value)">
                        <option value="social">Social</option>
                        <option value="work">Work</option>
                        <option value="events">Events</option>
                        <option value="exclusive">Exclusive</option>
                    </select>
                    <div class="preview-device-toggle">
                        <button class="device-btn active" data-device="mobile">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="5" y="2" width="14" height="20" rx="2"/><line x1="12" y1="18" x2="12" y2="18"/></svg>
                        </button>
                        <button class="device-btn" data-device="desktop">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                        </button>
                    </div>
                    <button class="preview-collapse-btn" id="preview-collapse-btn" onclick="togglePreview()" title="Hide preview">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                    </button>
                </div>
            </div>
            <div class="preview-container">
                <div class="preview-frame" id="preview-frame">
                    <iframe class="preview-iframe" id="preview-iframe" srcdoc="
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <link href='https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;1,400&family=DM+Sans:wght@300;400;500&family=Space+Mono&display=swap' rel='stylesheet'>
                            <style>
                                * { margin: 0; padding: 0; box-sizing: border-box; }
                                body { 
                                    font-family: 'DM Sans', sans-serif;
                                    background: #F4F3F0;
                                    color: #1C1C1C;
                                    min-height: 100vh;
                                    display: flex;
                                }
                                .signature-bar {
                                    width: 24px;
                                    background: #1A3A3A;
                                    display: flex;
                                    flex-direction: column;
                                    align-items: center;
                                    justify-content: space-between;
                                    padding: 1rem 0;
                                    flex-shrink: 0;
                                }
                                .sig-pulse {
                                    width: 5px;
                                    height: 5px;
                                    background: rgba(255,255,255,0.5);
                                    border-radius: 50%;
                                }
                                .sig-citizen {
                                    writing-mode: vertical-rl;
                                    transform: rotate(180deg);
                                    font-family: 'Space Mono', monospace;
                                    font-size: 0.45rem;
                                    color: rgba(255,255,255,0.7);
                                    letter-spacing: 0.05em;
                                }
                                .sig-brand {
                                    writing-mode: vertical-rl;
                                    transform: rotate(180deg);
                                    font-family: 'Cormorant Garamond', serif;
                                    font-style: italic;
                                    font-size: 0.7rem;
                                    color: rgba(255,255,255,0.8);
                                }
                                .main {
                                    flex: 1;
                                    padding: 1.5rem 1.25rem;
                                    overflow-y: auto;
                                }
                                .view-badge {
                                    display: inline-block;
                                    font-family: 'Space Mono', monospace;
                                    font-size: 0.5rem;
                                    text-transform: uppercase;
                                    letter-spacing: 0.08em;
                                    padding: 0.2rem 0.4rem;
                                    background: rgba(26,58,58,0.08);
                                    color: #1A3A3A;
                                    border-radius: 3px;
                                    margin-bottom: 0.75rem;
                                }
                                .avatar {
                                    width: 56px;
                                    height: 56px;
                                    border-radius: 50%;
                                    background: linear-gradient(135deg, #ddd 0%, #bbb 100%);
                                    margin-bottom: 0.5rem;
                                    border: 2px solid white;
                                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                                }
                                .name {
                                    font-family: 'Cormorant Garamond', serif;
                                    font-size: 1.3rem;
                                    font-weight: 500;
                                    margin-bottom: 0.1rem;
                                }
                                .handle {
                                    font-size: 0.75rem;
                                    color: #1A3A3A;
                                    font-weight: 500;
                                    margin-bottom: 0.2rem;
                                }
                                .flags {
                                    font-size: 0.8rem;
                                    margin-bottom: 0.3rem;
                                }
                                .citizen-badge {
                                    display: inline-block;
                                    font-family: 'Space Mono', monospace;
                                    font-size: 0.45rem;
                                    color: #6A635D;
                                    background: rgba(26,58,58,0.06);
                                    padding: 0.25rem 0.4rem;
                                    border-radius: 3px;
                                    text-transform: uppercase;
                                    border: 1px solid rgba(26,58,58,0.1);
                                    margin-bottom: 0.75rem;
                                }
                                .bio {
                                    font-size: 0.8rem;
                                    color: #6A635D;
                                    line-height: 1.5;
                                    margin-bottom: 0.75rem;
                                }
                                .featured {
                                    background: #1A3A3A;
                                    color: white;
                                    padding: 0.75rem;
                                    border-radius: 10px;
                                    margin-bottom: 0.5rem;
                                }
                                .featured-title {
                                    font-family: 'Cormorant Garamond', serif;
                                    font-size: 0.9rem;
                                    margin-bottom: 0.15rem;
                                }
                                .featured-desc {
                                    font-size: 0.65rem;
                                    opacity: 0.7;
                                }
                                .link {
                                    display: flex;
                                    align-items: center;
                                    gap: 0.6rem;
                                    background: #ECE8E2;
                                    border-radius: 10px;
                                    padding: 0.65rem 0.75rem;
                                    margin-bottom: 0.4rem;
                                    text-decoration: none;
                                    color: #1C1C1C;
                                }
                                .link-icon {
                                    width: 28px;
                                    height: 28px;
                                    background: white;
                                    border-radius: 6px;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: 0.9rem;
                                }
                                .link-title {
                                    font-size: 0.8rem;
                                    font-weight: 500;
                                }
                                .link-sub {
                                    font-size: 0.65rem;
                                    color: #6A635D;
                                }
                                .footer-icons {
                                    display: flex;
                                    justify-content: center;
                                    gap: 0.75rem;
                                    margin-top: 0.75rem;
                                    padding-top: 0.5rem;
                                    border-top: 1px solid rgba(26,58,58,0.08);
                                }
                                .footer-icon {
                                    width: 16px;
                                    height: 16px;
                                    background: rgba(26,58,58,0.1);
                                    border-radius: 50%;
                                }
                            </style>
                        </head>
                        <body>
                            <div class='signature-bar'>
                                <div>
                                    <div class='sig-pulse'></div>
                                    <div class='sig-citizen'>JFK • 0010</div>
                                </div>
                                <div class='sig-brand'>myOolala</div>
                            </div>
                            <div class='main'>
                                <div class='view-badge'>Social</div>
                                <div class='avatar'></div>
                                <div class='name'>Your Name</div>
                                <div class='handle'>@handle</div>
                                <div class='flags'>🇫🇷 → 🇦🇪</div>
                                <div class='citizen-badge'>JFK • 0010-2005 · New York</div>
                                <div class='bio'>Your bio will appear here...</div>
                                <div class='featured'>
                                    <div class='featured-title'>Featured Content</div>
                                    <div class='featured-desc'>Your spotlight moment</div>
                                </div>
                                <a class='link'>
                                    <div class='link-icon'>🔗</div>
                                    <div>
                                        <div class='link-title'>Your first link</div>
                                        <div class='link-sub'>Description</div>
                                    </div>
                                </a>
                                <a class='link'>
                                    <div class='link-icon'>📱</div>
                                    <div>
                                        <div class='link-title'>Another link</div>
                                        <div class='link-sub'>Description</div>
                                    </div>
                                </a>
                                <div class='footer-icons'>
                                    <div class='footer-icon'></div>
                                    <div class='footer-icon'></div>
                                    <div class='footer-icon'></div>
                                    <div class='footer-icon'></div>
                                </div>
                            </div>
                        </body>
                        </html>
                    "></iframe>
                </div>
            </div>
            <div class="preview-actions">
                <button class="btn btn-secondary" onclick="resetChanges()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
                    Reset
                </button>
                <button class="btn btn-primary" id="save-btn" onclick="saveAllChanges()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    Save Changes
                </button>
            </div>
        </aside>

    </div>

    <!-- Add Link Modal -->
    <div class="modal" id="add-link-modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">Add Link</span>
                <button class="icon-btn" onclick="closeModal('add-link-modal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="new-link-title" placeholder="My Website">
                </div>
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input type="url" class="form-input" id="new-link-url" placeholder="https://...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-link-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveNewLink()">Add Link</button>
            </div>
        </div>
    </div>

    <!-- Add Custom Social Modal -->
    <div class="modal" id="add-social-modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">Add Custom Social</span>
                <button class="icon-btn" onclick="closeModal('add-social-modal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Platform Name</label>
                    <input type="text" class="form-input" id="new-social-name" placeholder="Pinterest, Behance, Dribbble...">
                </div>
                <div class="form-group">
                    <label class="form-label">Profile URL</label>
                    <input type="url" class="form-input" id="new-social-url" placeholder="https://...">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-social-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveNewSocial()">Add Social</button>
            </div>
        </div>
    </div>

    <!-- Flag Picker Modal — Multi-selection -->
    <div class="modal" id="flag-picker-modal">
        <div class="modal-content wide">
            <div class="modal-header">
                <span class="modal-title">Add Countries to Your Journey</span>
                <button class="icon-btn" onclick="closeModal('flag-picker-modal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Search country</label>
                    <input type="text" class="form-input" id="flag-search" placeholder="Search by country name..." onkeyup="filterFlags(this.value)">
                </div>
                <div class="flag-picker-grid" id="flag-picker-grid">
                    <!-- Flags populated dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('flag-picker-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="addSelectedFlag()">Add Selected</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // ══════════════════════════════════════
        // ALIAS VALIDATION CONSTANTS
        // ══════════════════════════════════════
        const RESERVED_SLUGS = new Set(['v', 'settings', 'cockpit', 'admin', 'api', 'help', 'support', 'legal', 'terms', 'privacy', 'about', 'contact']);
        const SYSTEM_VIEWNAMES = new Set(['social', 'work', 'events', 'exclusive']);
        const SLUG_MIN = 3;
        const SLUG_MAX = 30;

        // ══════════════════════════════════════
        // SUPABASE CONFIG
        // ══════════════════════════════════════
        const SUPABASE_URL = 'https://txbteobudstggbhlcsyz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4YnRlb2J1ZHN0Z2diaGxjc3l6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyMjQwMTMsImV4cCI6MjA4MzgwMDAxM30.gbHggS8GtVVRsrYmtHS08fppmiWDKcwemqN3Aj4PYfg';
        
        let supabaseClient;
        let currentUser = null;
        let currentProfile = null;
        let currentBlocks = [];
        let hasUnsavedChanges = false;

        // ══════════════════════════════════════
        // INITIALIZATION
        // ══════════════════════════════════════
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize navigation first (always works)
            initNavigation();
            initToggles();
            initDeviceToggle();
            initAnalytics();
            
            try {
                // Try to init Supabase
                if (window.supabase) {
                    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    const { data: { session } } = await supabaseClient.auth.getSession();
                    
                    if (session) {
                        currentUser = session.user;
                        await loadUserData();
                    } else {
                        window.location.href = '/auth';
                        return;
                    }
                } else {
                    console.warn('Supabase not loaded, using demo data');
                    loadDemoData();
                }
            } catch (err) {
                console.warn('Supabase error, using demo data:', err);
                loadDemoData();
            }
            
            // These can work without Supabase
            initFlagPicker();
            initCharCounters();
            updateDropCountdown();
        });

        // ══════════════════════════════════════
        // DEMO DATA (when not authenticated)
        // ══════════════════════════════════════
        function loadDemoData() {
            try {
                const demoProfile = {
                    id: 'demo-user',
                    handle: 'sofiarey',
                    display_name: 'Sofia Reyes',
                    bio: 'Creative director & digital nomad. Building beautiful things from Dubai.',
                    spotlight: 'The journey is the destination.',
                    citizen_id: '0842',
                    plan: 'free',
                    views: 2847,
                    clicks: 156,
                    created_at: '2024-03-15',
                    origin_flags: ['🇲🇽'],
                    based_in_flag: '🇦🇪'
                };
                
                const demoBlocks = [
                    { id: '1', type: 'link', title: 'My Portfolio', url: 'https://sofiarey.com', order: 0 },
                    { id: '2', type: 'link', title: 'Book a Call', url: 'https://cal.com/sofiarey', order: 1 },
                    { id: '3', type: 'link', title: 'Latest Project', url: 'https://behance.net/sofiarey', order: 2 }
                ];
                
                currentProfile = demoProfile;
                currentBlocks = demoBlocks;
                
                populateCitizenPanel(demoProfile);
                populateProfileForm(demoProfile);
                populateBlocks(demoBlocks);
                updatePreviewUrl(demoProfile.handle);
            } catch (err) {
                console.warn('Error loading demo data:', err);
            }
        }

        // ══════════════════════════════════════
        // LOAD USER DATA
        // ══════════════════════════════════════
        async function loadUserData() {
            try {
                console.log('Loading user data for:', currentUser.id);
                
                // Get profile
                const { data: profile, error: profileError } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (profileError) {
                    console.error('Profile error:', profileError);
                    oolalaToast('Profile not found - redirecting to onboarding');
                    window.location.href = '/onboarding';
                    return;
                }
                
                if (!profile) {
                    console.error('No profile data');
                    window.location.href = '/onboarding';
                    return;
                }
                
                console.log('Profile loaded:', profile.handle);
                currentProfile = profile;
                
                // Get "social" view for this user
                const { data: socialView, error: viewError } = await supabaseClient
                    .from('views')
                    .select('id')
                    .eq('user_id', currentUser.id)
                    .eq('name', 'social')
                    .single();
                
                if (viewError) {
                    console.warn('No social view found:', viewError.message);
                }
                
                let blocks = [];
                if (socialView) {
                    console.log('Social view found:', socialView.id);
                    const { data: viewBlocks, error: blocksError } = await supabaseClient
                        .from('blocks')
                        .select('*')
                        .eq('view_id', socialView.id)
                        .order('order', { ascending: true });
                    
                    if (blocksError) {
                        console.warn('Blocks error:', blocksError.message);
                    }
                    blocks = viewBlocks || [];
                }
                
                console.log('Blocks loaded:', blocks.length);
                currentBlocks = blocks;
                
                // Populate UI
                populateCitizenPanel(profile);
                populateProfileForm(profile);
                populateBlocks(blocks);
                updatePreviewUrl(profile.handle);
                
                console.log('UI populated successfully');
                
            } catch (error) {
                console.error('Error loading data:', error);
                oolalaToast('Error loading your data: ' + error.message);
            }
        }

        // ══════════════════════════════════════
        // POPULATE CITIZEN PANEL
        // ══════════════════════════════════════
        function populateCitizenPanel(profile) {
            const getEl = (id) => document.getElementById(id);
            
            // Citizen ID
            const citizenId = profile.citizen_id || profile.id?.substring(0, 4) || '0001';
            const citizenDisplay = getEl('citizen-id-display');
            if (citizenDisplay) {
                citizenDisplay.textContent = `#${citizenId.toString().padStart(4, '0')}`;
            }
            
            // Plan badge
            const planBadge = getEl('citizen-plan-badge');
            const plan = profile.plan || 'free';
            if (planBadge) {
                if (plan === 'lifetime') {
                    planBadge.className = 'citizen-plan-badge lifetime';
                    planBadge.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg> Lifetime`;
                } else if (plan === 'pro') {
                    planBadge.className = 'citizen-plan-badge pro';
                    planBadge.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg> Pro`;
                } else {
                    planBadge.className = 'citizen-plan-badge';
                    planBadge.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Free`;
                }
            }
            
            // Stats
            const statViews = getEl('stat-views');
            const statClicks = getEl('stat-clicks');
            const statCtr = getEl('stat-ctr');
            if (statViews) statViews.textContent = formatNumber(profile.views || 0);
            if (statClicks) statClicks.textContent = formatNumber(profile.clicks || 0);
            if (statCtr) {
                const ctr = profile.views > 0 ? ((profile.clicks / profile.views) * 100).toFixed(1) : '0';
                statCtr.textContent = `${ctr}%`;
            }
            
            // Member since
            const memberSince = profile.created_at ? new Date(profile.created_at).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : '—';
            const memberSinceEl = getEl('member-since');
            const memberPlanEl = getEl('member-plan');
            if (memberSinceEl) memberSinceEl.textContent = memberSince;
            if (memberPlanEl) memberPlanEl.textContent = plan.charAt(0).toUpperCase() + plan.slice(1);
            
            // Hide upgrade button if already pro/lifetime
            const upgradeBtn = getEl('upgrade-btn');
            if (upgradeBtn && (plan === 'pro' || plan === 'lifetime')) {
                upgradeBtn.style.display = 'none';
            }
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        // ══════════════════════════════════════
        // MONTHLY DROP COUNTDOWN
        // ══════════════════════════════════════
        function updateDropCountdown() {
            const now = new Date();
            const nextMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);
            const daysLeft = Math.ceil((nextMonth - now) / (1000 * 60 * 60 * 24));
            const countdown = document.getElementById('drop-countdown');
            if (countdown) {
                countdown.textContent = `In ${daysLeft} days`;
            }
        }

        // ══════════════════════════════════════
        // POPULATE PROFILE FORM
        // ══════════════════════════════════════
        function populateProfileForm(profile) {
            const setVal = (id, val) => {
                const el = document.getElementById(id);
                if (el) el.value = val || '';
            };
            const setText = (id, val) => {
                const el = document.getElementById(id);
                if (el) el.textContent = val || '';
            };

            setVal('input-display-name', profile.display_name);
            setVal('input-username', profile.handle);
            setVal('input-bio', profile.bio);
            setVal('input-spotlight', profile.spotlight);
            
            // Update previews
            setText('username-preview', profile.handle || 'username');
            setText('spotlight-preview-text', `"${profile.spotlight || 'The journey is the destination...'}"`);
            
            // Update char counts
            updateCharCount('input-bio', 'bio-count');
            updateCharCount('input-spotlight', 'spotlight-count');
            
            // Flags (use origin_flags array and based_in_flag)
            const originFlag = profile.origin_flags && profile.origin_flags.length > 0 ? profile.origin_flags[0] : '🌍';
            const locationFlag = profile.based_in_flag || '🌍';
            setText('flags-preview', `${originFlag} → ${locationFlag}`);
            
            // Socials from socials table - load async
            loadSocials();
        }
        
        async function loadSocials() {
            if (!currentUser) return;
            try {
                const { data: socials } = await supabaseClient
                    .from('socials')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('order', { ascending: true });
                
                if (socials) {
                    socials.forEach(s => {
                        const el = document.getElementById(`social-${s.platform}`);
                        if (el) el.value = s.username || '';
                    });
                }
            } catch (err) {
                console.warn('Could not load socials:', err);
            }
        }

        // ══════════════════════════════════════
        // POPULATE BLOCKS (LINKS)
        // ══════════════════════════════════════
        function populateBlocks(blocks) {
            const linksContainer = document.getElementById('links-list');
            if (!linksContainer) return;
            
            linksContainer.innerHTML = '';
            
            // Handle null/undefined blocks
            if (!blocks || !Array.isArray(blocks)) {
                blocks = [];
            }
            
            const links = blocks.filter(b => b.type === 'link');
            const linksCount = document.getElementById('links-count');
            if (linksCount) {
                linksCount.textContent = `${links.length} link${links.length !== 1 ? 's' : ''}`;
            }
            
            links.forEach(block => {
                // Schema uses block.url directly, not payload.url
                const linkHtml = createLinkItem(block.id, block.title, block.url);
                linksContainer.insertAdjacentHTML('beforeend', linkHtml);
            });
            
            initDragAndDrop();
        }

        function createLinkItem(id, title, url) {
            return `
                <div class="sortable-item" draggable="true" data-block-id="${id}">
                    <span class="drag-handle">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="5" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="19" r="1"/></svg>
                    </span>
                    <div class="sortable-item-content">
                        <div class="sortable-item-title">${escapeHtml(title || '')}</div>
                        <div class="sortable-item-url">${escapeHtml(url || '')}</div>
                    </div>
                    <div class="sortable-item-actions">
                        <button class="icon-btn" onclick="editBlock('${id}')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                        </button>
                        <button class="icon-btn delete" onclick="deleteBlock('${id}')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        </button>
                    </div>
                </div>
            `;
        }

        // ══════════════════════════════════════
        // NAVIGATION
        // ══════════════════════════════════════
        function initNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const panel = item.dataset.panel;
                    const panelElement = document.getElementById(`panel-${panel}`);
                    
                    if (!panelElement) {
                        console.warn(`Panel not found: panel-${panel}`);
                        return;
                    }
                    
                    // Update nav
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Update panels
                    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                    panelElement.classList.add('active');
                });
            });
        }

        // ══════════════════════════════════════
        // TOGGLES
        // ══════════════════════════════════════
        function initToggles() {
            document.querySelectorAll('.toggle').forEach(toggle => {
                toggle.addEventListener('click', () => {
                    toggle.classList.toggle('active');
                    markUnsaved();
                });
            });
        }

        // ══════════════════════════════════════
        // CHARACTER COUNTERS
        // ══════════════════════════════════════
        function initCharCounters() {
            const bioInput = document.getElementById('input-bio');
            const spotlightInput = document.getElementById('input-spotlight');
            
            if (bioInput) {
                bioInput.addEventListener('input', () => {
                    updateCharCount('input-bio', 'bio-count');
                });
            }
            
            if (spotlightInput) {
                spotlightInput.addEventListener('input', () => {
                    updateCharCount('input-spotlight', 'spotlight-count');
                    document.getElementById('spotlight-preview-text').textContent = `"${spotlightInput.value || 'The journey is the destination...'}"`;
                });
            }
        }

        function updateCharCount(inputId, countId) {
            const input = document.getElementById(inputId);
            const count = document.getElementById(countId);
            if (input && count) {
                count.textContent = input.value.length;
            }
        }

        // ══════════════════════════════════════
        // DEVICE TOGGLE (PREVIEW)
        // ══════════════════════════════════════
        function initDeviceToggle() {
            document.querySelectorAll('.device-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.device-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const frame = document.getElementById('preview-frame');
                    if (frame) {
                        if (btn.dataset.device === 'desktop') {
                            frame.classList.add('desktop');
                        } else {
                            frame.classList.remove('desktop');
                        }
                    }
                });
            });
        }

        // ══════════════════════════════════════
        // MULTI-FLAG SELECTION
        // ══════════════════════════════════════
        let selectedFlags = ['MX', 'US']; // Array of selected country codes
        let tempSelectedFlag = null;

        // Provided by /js/countries.js (shared list across pages)
        const allCountries = COUNTRIES;

        function initFlagPicker() {
            renderFlagPickerGrid();
            renderSelectedFlags();
            initFlagDragDrop();
        }

        function renderFlagPickerGrid(filter = '') {
            const grid = document.getElementById('flag-picker-grid');
            if (!grid) return;
            
            const filtered = filter 
                ? allCountries.filter(c => c.name.toLowerCase().includes(filter.toLowerCase()) || c.code.toLowerCase().includes(filter.toLowerCase()))
                : allCountries;
            
            grid.innerHTML = filtered.map(c => `
                <div class="flag-picker-item ${selectedFlags.includes(c.code) ? 'selected' : ''} ${tempSelectedFlag === c.code ? 'active' : ''}" 
                     onclick="selectFlagForAdd('${c.code}')"
                     data-code="${c.code}">
                    <span class="flag-emoji">${c.emoji}</span>
                    <span class="flag-code">${c.code}</span>
                </div>
            `).join('');
        }

        function filterFlags(query) {
            renderFlagPickerGrid(query);
        }

        function selectFlagForAdd(code) {
            tempSelectedFlag = code;
            document.querySelectorAll('.flag-picker-item').forEach(item => {
                item.classList.toggle('active', item.dataset.code === code);
            });
        }

        function openFlagPicker() {
            tempSelectedFlag = null;
            renderFlagPickerGrid();
            openModal('flag-picker-modal');
        }

        function addSelectedFlag() {
            if (!tempSelectedFlag) {
                oolalaToast('Please select a country');
                return;
            }
            if (selectedFlags.includes(tempSelectedFlag)) {
                oolalaToast('Country already added');
                return;
            }
            selectedFlags.push(tempSelectedFlag);
            renderSelectedFlags();
            closeModal('flag-picker-modal');
            markUnsaved();
            oolalaToast('Country added to your journey');
        }

        function removeFlag(code) {
            if (selectedFlags.length <= 1) {
                oolalaToast('You need at least one country');
                return;
            }
            selectedFlags = selectedFlags.filter(c => c !== code);
            renderSelectedFlags();
            markUnsaved();
        }

        function renderSelectedFlags() {
            const container = document.getElementById('flags-selected');
            const previewText = document.getElementById('flags-preview-text');
            if (!container) return;

            const chips = selectedFlags.map(code => {
                const country = allCountries.find(c => c.code === code);
                return `<span class="flag-chip" data-country="${code}" draggable="true">${country?.emoji || code}<button class="flag-remove" onclick="removeFlag('${code}')">×</button></span>`;
            }).join('');

            container.innerHTML = chips + `<button class="flag-add-btn" onclick="openFlagPicker()">+ Add</button>`;
            
            // Update preview
            if (previewText) {
                const emojis = selectedFlags.map(code => {
                    const country = allCountries.find(c => c.code === code);
                    return country?.emoji || '';
                });
                previewText.textContent = emojis.join(' → ');
            }
            
            initFlagDragDrop();
        }

        function initFlagDragDrop() {
            const container = document.getElementById('flags-selected');
            if (!container) return;

            const chips = container.querySelectorAll('.flag-chip');
            chips.forEach(chip => {
                chip.addEventListener('dragstart', (e) => {
                    chip.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', chip.dataset.country);
                });

                chip.addEventListener('dragend', () => {
                    chip.classList.remove('dragging');
                });

                chip.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    const dragging = container.querySelector('.dragging');
                    if (dragging && dragging !== chip) {
                        const rect = chip.getBoundingClientRect();
                        const midX = rect.left + rect.width / 2;
                        if (e.clientX < midX) {
                            container.insertBefore(dragging, chip);
                        } else {
                            container.insertBefore(dragging, chip.nextSibling);
                        }
                    }
                });

                chip.addEventListener('drop', () => {
                    // Rebuild selectedFlags array based on new order
                    const newOrder = [...container.querySelectorAll('.flag-chip')].map(c => c.dataset.country);
                    selectedFlags = newOrder;
                    renderSelectedFlags();
                    markUnsaved();
                });
            });
        }

        // ══════════════════════════════════════
        // DRAG AND DROP
        // ══════════════════════════════════════
        function initDragAndDrop() {
            let draggedItem = null;

            document.querySelectorAll('.sortable-item').forEach(item => {
                item.addEventListener('dragstart', () => {
                    draggedItem = item;
                    item.classList.add('dragging');
                });

                item.addEventListener('dragend', () => {
                    item.classList.remove('dragging');
                    draggedItem = null;
                    markUnsaved();
                });

                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    if (draggedItem && draggedItem !== item) {
                        const list = item.parentNode;
                        const items = [...list.querySelectorAll('.sortable-item')];
                        const draggedIndex = items.indexOf(draggedItem);
                        const targetIndex = items.indexOf(item);
                        
                        if (draggedIndex < targetIndex) {
                            list.insertBefore(draggedItem, item.nextSibling);
                        } else {
                            list.insertBefore(draggedItem, item);
                        }
                    }
                });
            });
        }

        // ══════════════════════════════════════
        // MODALS
        // ══════════════════════════════════════
        function openModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function openUpgradeModal() {
            // TODO: Implement Stripe checkout
            oolalaToast('Upgrade coming soon!');
        }

        // ══════════════════════════════════════
        // ADD LINK
        // ══════════════════════════════════════
        async function saveNewLink() {
            const title = document.getElementById('new-link-title').value.trim();
            const url = document.getElementById('new-link-url').value.trim();
            
            if (!title || !url) {
                oolalaToast('Please fill in all fields');
                return;
            }

            try {
                // Get the social view id first
                const { data: socialView } = await supabaseClient
                    .from('views')
                    .select('id')
                    .eq('user_id', currentUser.id)
                    .eq('name', 'social')
                    .single();
                
                if (!socialView) {
                    oolalaToast('Error: No view found');
                    return;
                }
                
                const { data: block, error } = await supabaseClient
                    .from('blocks')
                    .insert({
                        view_id: socialView.id,
                        type: 'link',
                        title: title,
                        url: url,
                        order: currentBlocks.length
                    })
                    .select()
                    .single();

                if (error) throw error;

                currentBlocks.push(block);
                
                const linkHtml = createLinkItem(block.id, title, url);
                document.getElementById('links-list').insertAdjacentHTML('beforeend', linkHtml);
                document.getElementById('links-count').textContent = `${currentBlocks.filter(b => b.type === 'link').length} links`;
                
                // Clear inputs
                document.getElementById('new-link-title').value = '';
                document.getElementById('new-link-url').value = '';
                
                closeModal('add-link-modal');
                initDragAndDrop();
                oolalaToast('Link added');
                
            } catch (error) {
                console.error('Error adding link:', error);
                oolalaToast('Error adding link');
            }
        }

        // ══════════════════════════════════════
        // DELETE BLOCK
        // ══════════════════════════════════════
        async function deleteBlock(id) {
            if (!confirm('Delete this item?')) return;
            
            try {
                const { error } = await supabaseClient
                    .from('blocks')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                currentBlocks = currentBlocks.filter(b => b.id !== id);
                document.querySelector(`[data-block-id="${id}"]`)?.remove();
                document.getElementById('links-count').textContent = `${currentBlocks.filter(b => b.type === 'link').length} links`;
                
                oolalaToast('Item deleted');
                
            } catch (error) {
                console.error('Error deleting block:', error);
                oolalaToast('Error deleting item');
            }
        }

        // ══════════════════════════════════════
        // ADD EMAIL
        // ══════════════════════════════════════
        function addEmail() {
            const emailHtml = `
                <div class="contact-item">
                    <input type="email" class="form-input contact-input" placeholder="you@email.com" onchange="markUnsaved()">
                    <input type="text" class="form-input tag-input" placeholder="Tag" onchange="markUnsaved()">
                    <button class="icon-btn delete" onclick="this.closest('.contact-item').remove(); markUnsaved();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>
            `;
            document.getElementById('emails-list').insertAdjacentHTML('beforeend', emailHtml);
        }

        // ══════════════════════════════════════
        // ADD PHONE
        // ══════════════════════════════════════
        function addPhone() {
            const phoneHtml = `
                <div class="contact-item">
                    <div class="contact-item-info">
                        <input type="text" class="contact-input phone-number" placeholder="+1 234 567 8900" onchange="markUnsaved()">
                        <input type="text" class="contact-input phone-label" placeholder="Label (e.g. Personal, Work, WhatsApp...)" onchange="markUnsaved()">
                    </div>
                    <button class="contact-item-delete" onclick="this.parentElement.remove(); markUnsaved();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>
            `;
            document.getElementById('phones-list').insertAdjacentHTML('beforeend', phoneHtml);
            markUnsaved();
        }

        // ══════════════════════════════════════
        // ADD MESSAGING
        // ══════════════════════════════════════
        function addMessaging() {
            const messagingHtml = `
                <div class="contact-item with-platform">
                    <select class="form-input platform-select" onchange="markUnsaved()">
                        <option value="whatsapp">WhatsApp</option>
                        <option value="telegram">Telegram</option>
                        <option value="signal">Signal</option>
                    </select>
                    <input type="text" class="form-input contact-input" placeholder="+971501234567 or @username" onchange="markUnsaved()">
                    <input type="text" class="form-input tag-input" placeholder="Tag" onchange="markUnsaved()">
                    <button class="icon-btn delete" onclick="this.closest('.contact-item').remove(); markUnsaved();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>
            `;
            document.getElementById('messaging-list').insertAdjacentHTML('beforeend', messagingHtml);
        }

        // ══════════════════════════════════════
        // ADD CUSTOM SOCIAL
        // ══════════════════════════════════════
        function saveNewSocial() {
            const name = document.getElementById('new-social-name').value.trim();
            const url = document.getElementById('new-social-url').value.trim();
            
            if (!name || !url) {
                oolalaToast('Please fill in all fields');
                return;
            }

            oolalaToast('Custom social added');
            closeModal('add-social-modal');
            markUnsaved();
            
            // Clear inputs
            document.getElementById('new-social-name').value = '';
            document.getElementById('new-social-url').value = '';
        }

        // ══════════════════════════════════════
        // SAVE ALL CHANGES
        // ══════════════════════════════════════
        async function saveAllChanges() {
            if (!currentProfile) return;
            
            const profileUpdates = {
                display_name: document.getElementById('input-display-name')?.value.trim(),
                bio: document.getElementById('input-bio')?.value.trim(),
                spotlight: document.getElementById('input-spotlight')?.value.trim()
            };
            
            try {
                // Update profile
                const { error: profileError } = await supabaseClient
                    .from('profiles')
                    .update(profileUpdates)
                    .eq('id', currentUser.id);
                
                if (profileError) throw profileError;
                
                // Update socials in socials table
                const socialPlatforms = ['instagram', 'twitter', 'tiktok', 'linkedin', 'youtube', 'whatsapp', 'website'];
                
                for (let i = 0; i < socialPlatforms.length; i++) {
                    const platform = socialPlatforms[i];
                    const el = document.getElementById(`social-${platform}`);
                    const value = el?.value.trim() || '';
                    
                    if (value) {
                        // Upsert: insert or update
                        await supabaseClient
                            .from('socials')
                            .upsert({
                                user_id: currentUser.id,
                                platform: platform,
                                username: value,
                                order: i
                            }, { onConflict: 'user_id,platform' });
                    } else {
                        // Delete if empty
                        await supabaseClient
                            .from('socials')
                            .delete()
                            .eq('user_id', currentUser.id)
                            .eq('platform', platform);
                    }
                }
                
                currentProfile = { ...currentProfile, ...profileUpdates };
                hasUnsavedChanges = false;
                document.getElementById('save-btn')?.classList.remove('has-changes');
                oolalaToast('Changes saved');
                
            } catch (error) {
                console.error('Error saving:', error);
                oolalaToast('Error saving changes');
            }
        }

        function resetChanges() {
            if (!confirm('Discard unsaved changes?')) return;
            loadUserData();
            hasUnsavedChanges = false;
            document.getElementById('save-btn').classList.remove('has-changes');
            oolalaToast('Changes discarded');
        }

        function markUnsaved() {
            hasUnsavedChanges = true;
            document.getElementById('save-btn').classList.add('has-changes');
        }

        // ══════════════════════════════════════
        // UPDATE PREVIEW URL
        // ══════════════════════════════════════
        function updatePreviewUrl(handle) {
            const sidebarUrl = document.getElementById('sidebar-url');
            if (sidebarUrl) {
                sidebarUrl.textContent = `myoolala.com/u/${handle || 'username'}`;
            }
            
            // Preview iframe - don't load external URL in standalone mode
            // Will be connected to actual profile renderer in production
        }

        function copyProfileUrl() {
            const url = `https://myoolala.com/u/${currentProfile?.handle || 'username'}`;
            navigator.clipboard.writeText(url);
            oolalaToast('URL copied!');
        }

        // ══════════════════════════════════════
        // UTILITIES
        // ══════════════════════════════════════
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function isoToFlag(iso) {
            if (!iso || iso.length !== 2) return '🌍';
            const codePoints = iso.toUpperCase().split('').map(char => 127397 + char.charCodeAt(0));
            return String.fromCodePoint(...codePoints);
        }

        function oolalaToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ══════════════════════════════════════
        // MULTI-VIEWS FUNCTIONS
        // ══════════════════════════════════════
        
        function toggleViewExpand(viewName) {
            const viewItem = document.querySelector(`.view-item[data-view="${viewName}"]`);
            if (viewItem) {
                // Close other expanded views
                document.querySelectorAll('.view-item.expanded').forEach(item => {
                    if (item !== viewItem) item.classList.remove('expanded');
                });
                // Toggle this one
                viewItem.classList.toggle('expanded');
            }
        }

        function setViewVisibility(viewName, visibility) {
            const viewItem = document.querySelector(`.view-item[data-view="${viewName}"]`);
            if (!viewItem) return;

            // Update data attribute
            viewItem.dataset.visibility = visibility;

            // Update toggle buttons
            const switchContainer = viewItem.querySelector('.visibility-switch');
            switchContainer.querySelectorAll('.visibility-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.value === visibility);
            });

            // Update badge
            const badge = viewItem.querySelector('.view-visibility-badge');
            if (badge) {
                badge.className = 'view-visibility-badge ' + (visibility === 'public' ? 'public' : 'private');
                badge.textContent = visibility === 'public' ? 'Public' : 'By invitation';
            }

            // Update hint
            const hint = viewItem.querySelector('.view-visibility-hint');
            if (hint) {
                hint.textContent = visibility === 'public' 
                    ? "Anyone with the link — or who guesses it — can open this view."
                    : "Only people with your shared link can open this view. The standard URL won't work.";
            }

            // Update URL display
            const urlEl = viewItem.querySelector('.view-url');
            const username = document.getElementById('input-handle')?.value || 'sofia';
            if (visibility === 'public') {
                urlEl.className = 'view-url';
                urlEl.innerHTML = `myoolala.com/${username}<strong>/${viewName}</strong>`;
            } else {
                urlEl.className = 'view-url view-url-private';
                urlEl.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> By invitation only`;
            }

            // Show/hide permanent link section
            const permanentLinkSection = viewItem.querySelector('.view-permanent-link');
            if (permanentLinkSection) {
                permanentLinkSection.style.display = visibility === 'private_link' ? 'block' : 'none';
            }

            markUnsaved();
            oolalaToast(`${viewName} is now ${visibility === 'public' ? 'public' : 'by invitation'}`);
        }

        function showQR(viewName) {
            // TODO: Implement QR modal
            oolalaToast('QR Code coming soon...');
        }

        function revokeAlias(btn) {
            const aliasItem = btn.closest('.alias-item');
            if (aliasItem) {
                // Mark as revoked instead of removing (keeps history)
                aliasItem.dataset.status = 'revoked';
                aliasItem.classList.add('alias-revoked');
                
                // Disable input
                const input = aliasItem.querySelector('.alias-input');
                if (input) input.disabled = true;
                
                // Change revoke button to "restore" or hide it
                btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>`;
                btn.onclick = function() { restoreAlias(this); };
                btn.title = 'Restore';
                
                markUnsaved();
                oolalaToast('Alias revoked');
            }
        }

        function restoreAlias(btn) {
            const aliasItem = btn.closest('.alias-item');
            if (aliasItem) {
                aliasItem.dataset.status = 'active';
                aliasItem.classList.remove('alias-revoked');
                
                const input = aliasItem.querySelector('.alias-input');
                if (input) input.disabled = false;
                
                btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`;
                btn.onclick = function() { revokeAlias(this); };
                btn.title = 'Revoke';
                
                markUnsaved();
                oolalaToast('Alias restored');
            }
        }

        function copyViewUrl(viewName) {
            const viewItem = document.querySelector(`.view-item[data-view="${viewName}"]`);
            const visibility = viewItem?.dataset.visibility || 'public';
            const username = document.getElementById('input-handle')?.value || 'sofia';
            
            let url;
            if (visibility === 'public') {
                url = `https://myoolala.com/${username}/${viewName}`;
            } else {
                // Copy permanent link for private views
                const tokens = { work: 'Kp7mQ9x', exclusive: 'x7k9m2p3', social: 'Ab3cD4e', events: 'Fg5hI6j' };
                url = `https://myoolala.com/${username}/v/${tokens[viewName] || 'abc123'}`;
            }
            
            navigator.clipboard.writeText(url).then(() => {
                oolalaToast(`${viewName.charAt(0).toUpperCase() + viewName.slice(1)} link copied!`);
            });
        }

        function copyPermanentLink(viewName) {
            const username = document.getElementById('input-handle')?.value || 'sofia';
            const tokens = { work: 'Kp7mQ9x', exclusive: 'x7k9m2p3', social: 'Ab3cD4e', events: 'Fg5hI6j' };
            const url = `https://myoolala.com/${username}/v/${tokens[viewName] || 'abc123'}`;
            navigator.clipboard.writeText(url).then(() => {
                oolalaToast('Permanent link copied!');
            });
        }

        function copyAlias(alias) {
            const username = document.getElementById('input-handle')?.value || 'sofia';
            const url = `https://myoolala.com/${username}/${alias}`;
            navigator.clipboard.writeText(url).then(() => {
                oolalaToast(`Alias "${alias}" copied!`);
            });
        }

        // ══════════════════════════════════════
        // ALIAS VALIDATION
        // ══════════════════════════════════════
        function normalizeSlug(input) {
            return (input || '')
                .toLowerCase()
                .replace(/[^a-z0-9-]/g, '')
                .replace(/--+/g, '-')
                .replace(/^-+|-+$/g, '');
        }

        function getAllAliasSlugs() {
            // Collect all alias slugs from DOM (active and revoked)
            return Array.from(document.querySelectorAll('.alias-input'))
                .map(input => normalizeSlug(input.value))
                .filter(Boolean);
        }

        function validateAliasSlug(raw, currentInput) {
            const slug = normalizeSlug(raw);

            if (!slug) {
                return { ok: false, slug, reason: '' }; // Empty, no error shown
            }
            if (slug.length < SLUG_MIN) {
                return { ok: false, slug, reason: `At least ${SLUG_MIN} characters required` };
            }
            if (slug.length > SLUG_MAX) {
                return { ok: false, slug, reason: `Maximum ${SLUG_MAX} characters` };
            }
            if (RESERVED_SLUGS.has(slug)) {
                return { ok: false, slug, reason: 'This slug is reserved' };
            }
            if (SYSTEM_VIEWNAMES.has(slug)) {
                return { ok: false, slug, reason: 'Cannot use a view name as alias' };
            }

            // Check for duplicates (excluding current input)
            const existing = getAllAliasSlugs().filter(s => {
                if (!currentInput) return true;
                return s !== normalizeSlug(currentInput.defaultValue); // Exclude self
            });
            if (existing.includes(slug)) {
                return { ok: false, slug, reason: 'This alias already exists' };
            }

            return { ok: true, slug, reason: '' };
        }

        function validateAliasInput(input) {
            const result = validateAliasSlug(input.value, input);
            const aliasItem = input.closest('.alias-item');
            
            // Normalize input value
            if (input.value !== result.slug && result.slug) {
                input.value = result.slug;
            }

            // Update UI
            let errorEl = aliasItem.querySelector('.alias-error');
            if (!result.ok && result.reason) {
                aliasItem.classList.add('alias-invalid');
                if (!errorEl) {
                    errorEl = document.createElement('div');
                    errorEl.className = 'alias-error';
                    aliasItem.appendChild(errorEl);
                }
                errorEl.textContent = result.reason;
                errorEl.style.display = 'block';
            } else {
                aliasItem.classList.remove('alias-invalid');
                if (errorEl) errorEl.style.display = 'none';
            }

            return result.ok;
        }

        function addAlias(viewName) {
            const aliasList = document.getElementById(`${viewName}-alias-list`);
            if (!aliasList) return;

            const aliasHtml = `
                <div class="alias-item" data-status="active">
                    <div class="alias-input-row">
                        <span class="alias-prefix">myoolala.com/sofia/</span>
                        <input type="text" class="alias-input" placeholder="new-alias" 
                               oninput="validateAliasInput(this)" 
                               onblur="validateAliasInput(this); markUnsaved()">
                    </div>
                    <div class="alias-actions">
                        <button class="alias-copy-btn" onclick="copyAliasFromInput(this)" title="Copy">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                        </button>
                        <button class="alias-delete-btn" onclick="revokeAlias(this)" title="Revoke">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </div>
                </div>
            `;
            aliasList.insertAdjacentHTML('beforeend', aliasHtml);
            markUnsaved();
            
            // Focus the new input
            const newInput = aliasList.querySelector('.alias-item:last-child .alias-input');
            if (newInput) newInput.focus();
        }

        function copyAliasFromInput(btn) {
            const input = btn.closest('.alias-item').querySelector('.alias-input');
            if (input && input.value) {
                // Validate before copying
                if (validateAliasInput(input)) {
                    copyAlias(input.value);
                } else {
                    oolalaToast('Please fix the alias first');
                }
            }
        }

        function editView(viewName) {
            // Scroll to link management section if exists
            const linkMgmt = document.getElementById(`${viewName}-link-management`);
            if (linkMgmt) {
                linkMgmt.scrollIntoView({ behavior: 'smooth', block: 'start' });
                linkMgmt.style.boxShadow = '0 0 0 2px var(--signature)';
                setTimeout(() => {
                    linkMgmt.style.boxShadow = '';
                }, 2000);
            } else {
                oolalaToast(`Editing ${viewName} view...`);
            }
        }

        function previewView(viewName) {
            // Switch preview to show specific view
            document.getElementById('preview-view-select').value = viewName;
            switchPreviewView(viewName);
        }

        function switchPreviewView(viewName) {
            // Update view badge in preview
            const iframe = document.getElementById('preview-iframe');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const viewBadge = iframeDoc.querySelector('.view-badge');
            if (viewBadge) {
                viewBadge.textContent = viewName.charAt(0).toUpperCase() + viewName.slice(1);
            }
            oolalaToast(`Previewing ${viewName} view`);
        }

        function setDefaultView(viewName) {
            oolalaToast(`Default view set to ${viewName}`);
            markUnsaved();
        }

        function upgradeToPro() {
            oolalaToast('Redirecting to Pro upgrade...');
            // TODO: Implement Stripe checkout
            window.open('https://myoolala.com/pricing', '_blank');
        }

        function initAnalytics() {
            // Analytics period selector
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.classList.contains('pro-only')) {
                        upgradeToPro();
                        return;
                    }
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    oolalaToast(`Showing ${btn.dataset.period} data`);
                });
            });

            // Leaderboard tabs
            document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.leaderboard-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    oolalaToast(`Showing ${tab.textContent} leaderboard`);
                });
            });
        }

        // ══════════════════════════════════════
        // HOME BASE / AIRPORT SEARCH
        // ══════════════════════════════════════
        const airports = [
            { code: 'JFK', city: 'New York', country: 'USA' },
            { code: 'LAX', city: 'Los Angeles', country: 'USA' },
            { code: 'SFO', city: 'San Francisco', country: 'USA' },
            { code: 'MIA', city: 'Miami', country: 'USA' },
            { code: 'ORD', city: 'Chicago', country: 'USA' },
            { code: 'DXB', city: 'Dubai', country: 'UAE' },
            { code: 'AUH', city: 'Abu Dhabi', country: 'UAE' },
            { code: 'LHR', city: 'London', country: 'UK' },
            { code: 'CDG', city: 'Paris', country: 'France' },
            { code: 'AMS', city: 'Amsterdam', country: 'Netherlands' },
            { code: 'FRA', city: 'Frankfurt', country: 'Germany' },
            { code: 'SIN', city: 'Singapore', country: 'Singapore' },
            { code: 'HKG', city: 'Hong Kong', country: 'Hong Kong' },
            { code: 'NRT', city: 'Tokyo', country: 'Japan' },
            { code: 'SYD', city: 'Sydney', country: 'Australia' },
            { code: 'GRU', city: 'São Paulo', country: 'Brazil' },
            { code: 'MEX', city: 'Mexico City', country: 'Mexico' },
            { code: 'YYZ', city: 'Toronto', country: 'Canada' },
            { code: 'GBO', city: 'Gaborone', country: 'Botswana' },
            { code: 'JNB', city: 'Johannesburg', country: 'South Africa' },
            { code: 'LIS', city: 'Lisbon', country: 'Portugal' },
            { code: 'BCN', city: 'Barcelona', country: 'Spain' },
            { code: 'FCO', city: 'Rome', country: 'Italy' },
            { code: 'MUC', city: 'Munich', country: 'Germany' },
            { code: 'IST', city: 'Istanbul', country: 'Turkey' },
        ];

        function searchAirport(query) {
            const resultsDiv = document.getElementById('airport-results');
            if (!query || query.length < 2) {
                resultsDiv.style.display = 'none';
                return;
            }

            const q = query.toLowerCase();
            const matches = airports.filter(a => 
                a.code.toLowerCase().includes(q) || 
                a.city.toLowerCase().includes(q) ||
                a.country.toLowerCase().includes(q)
            ).slice(0, 5);

            if (matches.length === 0) {
                resultsDiv.style.display = 'none';
                return;
            }

            resultsDiv.innerHTML = matches.map(a => `
                <div class="airport-option" onclick="selectAirport('${a.code}', '${a.city}')">
                    <span class="airport-option-code">${a.code}</span>
                    <span>${a.city}, ${a.country}</span>
                </div>
            `).join('');
            resultsDiv.style.display = 'block';
        }

        function selectAirport(code, city) {
            const citizenNumber = '0010'; // This would come from user data
            const year = '2005'; // Join year
            const ref = `${code} • ${citizenNumber}-${year}`;

            document.getElementById('homebase-display').innerHTML = `
                <div class="homebase-code">${code}</div>
                <div class="homebase-info">
                    <div class="homebase-city">${city}</div>
                    <div class="homebase-ref">${ref}</div>
                </div>
            `;
            document.getElementById('homebase-search').value = '';
            document.getElementById('airport-results').style.display = 'none';
            markUnsaved();
            oolalaToast(`Home base set to ${code}`);
        }

        // Warn before leaving with unsaved changes
        window.addEventListener('beforeunload', (e) => {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // ══════════════════════════════════════
        // PRO MODE TOGGLE
        // ══════════════════════════════════════
        let isProMode = true; // Default to Pro for demo

        function toggleProMode() {
            isProMode = !isProMode;
            
            // Update body class
            document.body.classList.toggle('pro-mode', isProMode);
            
            // Update toggle UI
            const options = document.querySelectorAll('.pro-toggle-option');
            options.forEach(opt => {
                opt.classList.remove('active');
                if ((opt.dataset.mode === 'pro' && isProMode) || 
                    (opt.dataset.mode === 'free' && !isProMode)) {
                    opt.classList.add('active');
                }
            });
            
            // Update citizen badge
            updateCitizenBadge();
            
            oolalaToast(isProMode ? '✨ Platinum mode activated' : 'Switched to Free mode');
        }

        function updateCitizenBadge() {
            const badge = document.getElementById('citizen-plan-badge');
            if (badge) {
                badge.innerHTML = isProMode 
                    ? `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg> Platinum`
                    : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> Free`;
            }
        }

        // ══════════════════════════════════════
        // PREVIEW PANEL TOGGLE
        // ══════════════════════════════════════
        let isPreviewCollapsed = false;

        function togglePreview() {
            isPreviewCollapsed = !isPreviewCollapsed;
            const cockpit = document.querySelector('.cockpit');
            const previewPanel = document.querySelector('.preview-panel');
            if (previewPanel) {
                previewPanel.classList.toggle('collapsed', isPreviewCollapsed);
            }
            if (cockpit) {
                cockpit.classList.toggle('preview-collapsed', isPreviewCollapsed);
            }
            oolalaToast(isPreviewCollapsed ? 'Preview hidden' : 'Preview shown');
        }

        // Initialize Pro mode on load
        document.addEventListener('DOMContentLoaded', () => {
            document.body.classList.add('pro-mode');
            updateCitizenBadge();
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- supabase-config.js removed - config is inline -->
</body>
</html>
